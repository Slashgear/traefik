(window.webpackJsonp=window.webpackJsonp||[]).push([[38],{194:function(t,e,a){"use strict";a.r(e);var s=a(0),r=Object(s.a)({},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"content"},[t._m(0),t._v(" "),a("p",[t._v("This section explains how to create a multi-host docker cluster with swarm mode using "),a("a",{attrs:{href:"https://docs.docker.com/machine",target:"_blank",rel:"noopener noreferrer"}},[t._v("docker-machine"),a("OutboundLink")],1),t._v(" and how to deploy Traefik on it.")]),t._v(" "),a("p",[t._v("The cluster consists of:")]),t._v(" "),a("ul",[a("li",[t._v("3 servers")]),t._v(" "),a("li",[t._v("1 manager")]),t._v(" "),a("li",[t._v("2 workers")]),t._v(" "),a("li",[t._v("1 "),a("a",{attrs:{href:"https://docs.docker.com/network/overlay/",target:"_blank",rel:"noopener noreferrer"}},[t._v("overlay"),a("OutboundLink")],1),t._v(" network (multi-host networking)")])]),t._v(" "),t._m(1),t._v(" "),a("ol",[a("li",[t._v("You will need to install "),a("a",{attrs:{href:"https://docs.docker.com/machine/",target:"_blank",rel:"noopener noreferrer"}},[t._v("docker-machine"),a("OutboundLink")],1)]),t._v(" "),a("li",[t._v("You will need the latest "),a("a",{attrs:{href:"https://www.virtualbox.org/wiki/Downloads",target:"_blank",rel:"noopener noreferrer"}},[t._v("VirtualBox"),a("OutboundLink")],1)])]),t._v(" "),t._m(2),t._v(" "),a("p",[t._v("First, let's create all the required nodes.\nIt's a shorter version of the "),a("a",{attrs:{href:"https://docs.docker.com/engine/swarm/swarm-tutorial/",target:"_blank",rel:"noopener noreferrer"}},[t._v("swarm tutorial"),a("OutboundLink")],1),t._v(".")]),t._v(" "),t._m(3),a("p",[t._v("Then, let's setup the cluster, in order:")]),t._v(" "),t._m(4),t._v(" "),t._m(5),a("p",[t._v("Let's validate the cluster is up and running.")]),t._v(" "),t._m(6),t._m(7),a("p",[t._v("Finally, let's create a network for Traefik to use.")]),t._v(" "),t._m(8),t._m(9),t._v(" "),a("p",[t._v("Let's deploy Traefik as a docker service in our cluster.\nThe only requirement for Traefik to work with swarm mode is that it needs to run on a manager node - we are going to use a "),a("a",{attrs:{href:"https://docs.docker.com/engine/reference/commandline/service_create/#specify-service-constraints---constraint",target:"_blank",rel:"noopener noreferrer"}},[t._v("constraint"),a("OutboundLink")],1),t._v(" for that.")]),t._v(" "),t._m(10),a("p",[t._v("Let's explain this command:")]),t._v(" "),t._m(11),t._v(" "),t._m(12),t._v(" "),a("p",[t._v("We can now deploy our app on the cluster, here "),a("a",{attrs:{href:"https://github.com/containous/whoami",target:"_blank",rel:"noopener noreferrer"}},[t._v("whoami"),a("OutboundLink")],1),t._v(", a simple web server in Go.\nWe start 2 services, on the "),a("code",[t._v("traefik-net")]),t._v(" network.")]),t._v(" "),t._m(13),t._m(14),t._v(" "),t._m(15),t._v(" "),a("p",[t._v("Check that everything is scheduled and started:")]),t._v(" "),t._m(16),t._m(17),t._m(18),t._v(" "),t._m(19),t._m(20),t._m(21),t._m(22),t._m(23),t._v(" "),t._m(24),t._m(25),t._m(26),t._m(27),t._m(28),t._v(" "),t._m(29),t._m(30),t._v(" "),t._m(31),t._m(32),t._m(33),t._v(" "),a("p",[t._v("Repeat the following command multiple times and note that the Hostname changes each time as Traefik load balances each request against the 5 tasks:")]),t._v(" "),t._m(34),t._m(35),t._m(36),t._v(" "),t._m(37),t._m(38),t._m(39),t._v(" "),t._m(40),t._m(41),t._m(42),t._v(" "),t._m(43),t._m(44),t._m(45)])},[function(){var t=this.$createElement,e=this._self._c||t;return e("h1",{attrs:{id:"docker-swarm-mode-cluster"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#docker-swarm-mode-cluster","aria-hidden":"true"}},[this._v("#")]),this._v(" Docker Swarm (mode) cluster")])},function(){var t=this.$createElement,e=this._self._c||t;return e("h2",{attrs:{id:"prerequisites"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#prerequisites","aria-hidden":"true"}},[this._v("#")]),this._v(" Prerequisites")])},function(){var t=this.$createElement,e=this._self._c||t;return e("h2",{attrs:{id:"cluster-provisioning"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#cluster-provisioning","aria-hidden":"true"}},[this._v("#")]),this._v(" Cluster provisioning")])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[this._v("docker-machine create -d virtualbox manager\ndocker-machine create -d virtualbox worker1\ndocker-machine create -d virtualbox worker2\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("ol",[e("li",[this._v("initialize the cluster")]),this._v(" "),e("li",[this._v("get the token for other host to join")]),this._v(" "),e("li",[this._v("on both workers, join the cluster with the token")])])},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("docker-machine "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("ssh")]),t._v(" manager "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"docker swarm init \\\n\t--listen-addr '),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$(")]),t._v("docker-machine ip manager"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v(")")])]),t._v(" \\\n\t--advertise-addr "),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$(")]),t._v("docker-machine ip manager"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v(")")])]),t._v('"')]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("export")]),t._v(" worker_token"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$(")]),t._v("docker-machine "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("ssh")]),t._v(" manager "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"docker swarm \\\njoin-token worker -q"')]),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v(")")])]),t._v("\n\ndocker-machine "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("ssh")]),t._v(" worker1 "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"docker swarm join \\\n\t--token='),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("${worker_token}")]),t._v(" \\\n\t--listen-addr "),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$(")]),t._v("docker-machine ip worker1"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v(")")])]),t._v(" \\\n\t--advertise-addr "),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$(")]),t._v("docker-machine ip worker1"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v(")")])]),t._v(" \\\n\t"),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$(")]),t._v("docker-machine ip manager"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v(")")])]),t._v('"')]),t._v("\n\ndocker-machine "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("ssh")]),t._v(" worker2 "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"docker swarm join \\\n\t--token='),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("${worker_token}")]),t._v(" \\\n\t--listen-addr "),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$(")]),t._v("docker-machine ip worker2"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v(")")])]),t._v(" \\\n\t--advertise-addr "),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$(")]),t._v("docker-machine ip worker2"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v(")")])]),t._v(" \\\n\t"),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$(")]),t._v("docker-machine ip manager"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v(")")])]),t._v('"')]),t._v("\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[this._v("docker-machine "),e("span",{pre:!0,attrs:{class:"token function"}},[this._v("ssh")]),this._v(" manager docker node "),e("span",{pre:!0,attrs:{class:"token function"}},[this._v("ls")]),this._v("\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v("ID                           HOSTNAME  STATUS  AVAILABILITY  MANAGER STATUS\n013v16l1sbuwjqcn7ucbu4jwt    worker1   Ready   Active\n8buzkquycd17jqjber0mo2gn8    worker2   Ready   Active\nfnpj8ozfc85zvahx2r540xfcf *  manager   Ready   Active        Leader\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[this._v("docker-machine "),e("span",{pre:!0,attrs:{class:"token function"}},[this._v("ssh")]),this._v(" manager "),e("span",{pre:!0,attrs:{class:"token string"}},[this._v('"docker network create --driver=overlay traefik-net"')]),this._v("\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h2",{attrs:{id:"deploy-traefik"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#deploy-traefik","aria-hidden":"true"}},[this._v("#")]),this._v(" Deploy Traefik")])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[this._v("docker-machine "),e("span",{pre:!0,attrs:{class:"token function"}},[this._v("ssh")]),this._v(" manager "),e("span",{pre:!0,attrs:{class:"token string"}},[this._v('"docker service create \\\n\t--name traefik \\\n\t--constraint=node.role==manager \\\n\t--publish 80:80 --publish 8080:8080 \\\n\t--mount\ttype=bind,source=/var/run/docker.sock,target=/var/run/docker.sock \\\n\t--network traefik-net \\\n\ttraefik \\\n\t--docker \\\n\t--docker.swarmMode \\\n\t--docker.domain=traefik \\\n\t--docker.watch \\\n\t--api"')]),this._v("\n")])])])},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("table",[a("thead",[a("tr",[a("th",[t._v("Option")]),t._v(" "),a("th",[t._v("Description")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[a("code",[t._v("--publish 80:80 --publish 8080:8080")])]),t._v(" "),a("td",[t._v("we publish port "),a("code",[t._v("80")]),t._v(" and "),a("code",[t._v("8080")]),t._v(" on the cluster.")])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("--constraint=node.role==manager")])]),t._v(" "),a("td",[t._v("we ask docker to schedule Traefik on a manager node.")])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("--mount type=bind,source=/var/run/docker.sock,target=/var/run/docker.sock")])]),t._v(" "),a("td",[t._v("we bind mount the docker socket where Traefik is scheduled to be able to speak to the daemon.")])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("--network traefik-net")])]),t._v(" "),a("td",[t._v("we attach the Traefik service (and thus the underlying container) to the "),a("code",[t._v("traefik-net")]),t._v(" network.")])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("--docker")])]),t._v(" "),a("td",[t._v("enable docker provider, and "),a("code",[t._v("--docker.swarmMode")]),t._v(" to enable the swarm mode on Traefik.")])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("--api")])]),t._v(" "),a("td",[t._v("activate the webUI on port 8080")])])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h2",{attrs:{id:"deploy-your-apps"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#deploy-your-apps","aria-hidden":"true"}},[this._v("#")]),this._v(" Deploy your apps")])},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("docker-machine "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("ssh")]),t._v(" manager "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"docker service create \\\n\t--name whoami0 \\\n\t--label traefik.port=80 \\\n\t--network traefik-net \\\n\tcontainous/whoami"')]),t._v("\n\ndocker-machine "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("ssh")]),t._v(" manager "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"docker service create \\\n\t--name whoami1 \\\n\t--label traefik.port=80 \\\n\t--network traefik-net \\\n\tcontainous/whoami"')]),t._v("\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"tip custom-block"},[e("p",{staticClass:"custom-block-title"},[this._v("TIP")]),this._v(" "),e("pre",[e("code",[this._v("We set `whoami1` to use sticky sessions (`--label traefik.backend.loadbalancer.stickiness=true`).\nWe'll demonstrate that later.\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"tip custom-block"},[e("p",{staticClass:"custom-block-title"},[this._v("TIP")]),this._v(" "),e("pre",[e("code",[this._v("If using `docker stack deploy`, there is [a specific way that the labels must be defined in the docker-compose file](https://github.com/containous/traefik/issues/994#issuecomment-269095109).\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[this._v("docker-machine "),e("span",{pre:!0,attrs:{class:"token function"}},[this._v("ssh")]),this._v(" manager "),e("span",{pre:!0,attrs:{class:"token string"}},[this._v('"docker service ls"')]),this._v("\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v("ID            NAME     MODE        REPLICAS  IMAGE                     PORTS\nmoq3dq4xqv6t  traefik  replicated  1/1       traefik:latest            *:80->80/tcp,*:8080->8080/tcp\nysil6oto1wim  whoami0  replicated  1/1       containous/whoami:latest\nz9re2mnl34k4  whoami1  replicated  1/1       containous/whoami:latest\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h2",{attrs:{id:"access-to-your-apps-through-traefik"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#access-to-your-apps-through-traefik","aria-hidden":"true"}},[this._v("#")]),this._v(" Access to your apps through Traefik")])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[this._v("curl")]),this._v(" -H Host:whoami0.traefik http://"),e("span",{pre:!0,attrs:{class:"token variable"}},[e("span",{pre:!0,attrs:{class:"token variable"}},[this._v("$(")]),this._v("docker-machine ip manager"),e("span",{pre:!0,attrs:{class:"token variable"}},[this._v(")")])]),this._v("\n")])])])},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("Hostname")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 5b0b3d148359\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("IP")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 127.0.0.1\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("IP")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 10.0.0.8\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("IP")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 10.0.0.4\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("IP")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 172.18.0.5\nGET / HTTP/1.1\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("Host")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" whoami0.traefik\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("User-Agent")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" curl/7.55.1\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("Accept")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" */*\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("Accept-Encoding")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" gzip\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("X-Forwarded-For")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 10.255.0.2\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("X-Forwarded-Host")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" whoami0.traefik\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("X-Forwarded-Proto")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" http\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("X-Forwarded-Server")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 77fc29c69fe4\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[this._v("curl")]),this._v(" -H Host:whoami1.traefik http://"),e("span",{pre:!0,attrs:{class:"token variable"}},[e("span",{pre:!0,attrs:{class:"token variable"}},[this._v("$(")]),this._v("docker-machine ip manager"),e("span",{pre:!0,attrs:{class:"token variable"}},[this._v(")")])]),this._v("\n")])])])},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("Hostname")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 3633163970f6\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("IP")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 127.0.0.1\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("IP")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 10.0.0.14\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("IP")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 10.0.0.6\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("IP")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 172.18.0.5\nGET / HTTP/1.1\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("Host")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" whoami1.traefik\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("User-Agent")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" curl/7.55.1\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("Accept")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" */*\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("Accept-Encoding")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" gzip\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("X-Forwarded-For")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 10.255.0.2\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("X-Forwarded-Host")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" whoami1.traefik\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("X-Forwarded-Proto")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" http\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("X-Forwarded-Server")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 77fc29c69fe4\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"tip custom-block"},[e("p",{staticClass:"custom-block-title"},[this._v("TIP")]),this._v(" "),e("pre",[e("code",[this._v("As Traefik is published, you can access it from any machine and not only the manager.\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[this._v("curl")]),this._v(" -H Host:whoami0.traefik http://"),e("span",{pre:!0,attrs:{class:"token variable"}},[e("span",{pre:!0,attrs:{class:"token variable"}},[this._v("$(")]),this._v("docker-machine ip worker1"),e("span",{pre:!0,attrs:{class:"token variable"}},[this._v(")")])]),this._v("\n")])])])},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("Hostname")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 5b0b3d148359\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("IP")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 127.0.0.1\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("IP")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 10.0.0.8\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("IP")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 10.0.0.4\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("IP")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 172.18.0.5\nGET / HTTP/1.1\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("Host")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" whoami0.traefik\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("User-Agent")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" curl/7.55.1\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("Accept")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" */*\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("Accept-Encoding")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" gzip\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("X-Forwarded-For")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 10.255.0.3\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("X-Forwarded-Host")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" whoami0.traefik\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("X-Forwarded-Proto")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" http\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("X-Forwarded-Server")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 77fc29c69fe4\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[this._v("curl")]),this._v(" -H Host:whoami1.traefik http://"),e("span",{pre:!0,attrs:{class:"token variable"}},[e("span",{pre:!0,attrs:{class:"token variable"}},[this._v("$(")]),this._v("docker-machine ip worker2"),e("span",{pre:!0,attrs:{class:"token variable"}},[this._v(")")])]),this._v("\n")])])])},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("Hostname")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 3633163970f6\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("IP")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 127.0.0.1\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("IP")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 10.0.0.14\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("IP")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 10.0.0.6\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("IP")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 172.18.0.5\nGET / HTTP/1.1\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("Host")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" whoami1.traefik\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("User-Agent")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" curl/7.55.1\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("Accept")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" */*\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("Accept-Encoding")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" gzip\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("X-Forwarded-For")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 10.255.0.4\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("X-Forwarded-Host")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" whoami1.traefik\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("X-Forwarded-Proto")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" http\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("X-Forwarded-Server")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 77fc29c69fe4\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h2",{attrs:{id:"scale-both-services"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#scale-both-services","aria-hidden":"true"}},[this._v("#")]),this._v(" Scale both services")])},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("docker-machine "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("ssh")]),t._v(" manager "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"docker service scale whoami0=5"')]),t._v("\ndocker-machine "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("ssh")]),t._v(" manager "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"docker service scale whoami1=5"')]),t._v("\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("Check that we now have 5 replicas of each "),e("code",[this._v("whoami")]),this._v(" service:")])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[this._v("docker-machine "),e("span",{pre:!0,attrs:{class:"token function"}},[this._v("ssh")]),this._v(" manager "),e("span",{pre:!0,attrs:{class:"token string"}},[this._v('"docker service ls"')]),this._v("\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v("ID            NAME     MODE        REPLICAS  IMAGE                     PORTS\nmoq3dq4xqv6t  traefik  replicated  1/1       traefik:latest            *:80->80/tcp,*:8080->8080/tcp\nysil6oto1wim  whoami0  replicated  5/5       containous/whoami:latest\nz9re2mnl34k4  whoami1  replicated  5/5       containous/whoami:latest\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h2",{attrs:{id:"access-to-your-whoami0-through-traefik-multiple-times"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#access-to-your-whoami0-through-traefik-multiple-times","aria-hidden":"true"}},[this._v("#")]),this._v(" Access to your "),e("code",[this._v("whoami0")]),this._v(" through Traefik multiple times.")])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[this._v("curl")]),this._v(" -H Host:whoami0.traefik http://"),e("span",{pre:!0,attrs:{class:"token variable"}},[e("span",{pre:!0,attrs:{class:"token variable"}},[this._v("$(")]),this._v("docker-machine ip manager"),e("span",{pre:!0,attrs:{class:"token variable"}},[this._v(")")])]),this._v("\n")])])])},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("Hostname")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" f3138d15b567\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("IP")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 127.0.0.1\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("IP")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 10.0.0.5\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("IP")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 10.0.0.4\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("IP")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 172.18.0.3\nGET / HTTP/1.1\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("Host")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" whoami0.traefik\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("User-Agent")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" curl/7.55.1\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("Accept")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" */*\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("Accept-Encoding")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" gzip\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("X-Forwarded-For")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 10.255.0.2\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("X-Forwarded-Host")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" whoami0.traefik\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("X-Forwarded-Proto")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" http\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("X-Forwarded-Server")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 77fc29c69fe4\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("Do the same against "),e("code",[this._v("whoami1")]),this._v(":")])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[this._v("curl")]),this._v(" -c cookies.txt -H Host:whoami1.traefik http://"),e("span",{pre:!0,attrs:{class:"token variable"}},[e("span",{pre:!0,attrs:{class:"token variable"}},[this._v("$(")]),this._v("docker-machine ip manager"),e("span",{pre:!0,attrs:{class:"token variable"}},[this._v(")")])]),this._v("\n")])])])},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("Hostname")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 348e2f7bf432\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("IP")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 127.0.0.1\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("IP")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 10.0.0.15\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("IP")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 10.0.0.6\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("IP")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 172.18.0.6\nGET / HTTP/1.1\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("Host")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" whoami1.traefik\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("User-Agent")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" curl/7.55.1\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("Accept")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" */*\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("Accept-Encoding")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" gzip\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("X-Forwarded-For")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 10.255.0.2\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("X-Forwarded-Host")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" whoami1.traefik\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("X-Forwarded-Proto")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" http\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("X-Forwarded-Server")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 77fc29c69fe4\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("Because the sticky sessions require cookies to work, we used the "),e("code",[this._v("-c cookies.txt")]),this._v(" option to store the cookie into a file.\nThe cookie contains the IP of the container to which the session sticks:")])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[this._v("cat")]),this._v(" ./cookies.txt\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v("# Netscape HTTP Cookie File\n# https://curl.haxx.se/docs/http-cookies.html\n# This file was generated by libcurl! Edit at your own risk.\n\nwhoami1.traefik FALSE  /  FALSE  0  _TRAEFIK_BACKEND  http://10.0.0.15:80\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("If you load the cookies file ("),e("code",[this._v("-b cookies.txt")]),this._v(") for the next request, you will see that stickiness is maintained:")])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[this._v("curl")]),this._v(" -b cookies.txt -H Host:whoami1.traefik http://"),e("span",{pre:!0,attrs:{class:"token variable"}},[e("span",{pre:!0,attrs:{class:"token variable"}},[this._v("$(")]),this._v("docker-machine ip manager"),e("span",{pre:!0,attrs:{class:"token variable"}},[this._v(")")])]),this._v("\n")])])])},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("Hostname")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 348e2f7bf432\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("IP")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 127.0.0.1\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("IP")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 10.0.0.15\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("IP")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 10.0.0.6\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("IP")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 172.18.0.6\nGET / HTTP/1.1\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("Host")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" whoami1.traefik\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("User-Agent")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" curl/7.55.1\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("Accept")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" */*\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("Accept-Encoding")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" gzip\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("Cookie")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" _TRAEFIK_BACKEND=http"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("//10.0.0.15"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("X-Forwarded-For")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 10.255.0.2\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("X-Forwarded-Host")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" whoami1.traefik\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("X-Forwarded-Proto")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" http\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("X-Forwarded-Server")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 77fc29c69fe4\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[e("img",{attrs:{src:"https://i.giphy.com/ujUdrdpX7Ok5W.gif",alt:"GIF Magica"}})])}],!1,null,null,null);e.default=r.exports}}]);