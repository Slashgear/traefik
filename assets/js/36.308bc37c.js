(window.webpackJsonp=window.webpackJsonp||[]).push([[36],{197:function(t,e,s){"use strict";s.r(e);var a=s(0),n=Object(a.a)({},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"content"},[t._m(0),t._v(" "),s("p",[t._v("Both "),s("router-link",{attrs:{to:"/user-guide/kv-config/#static-configuration-in-key-value-store"}},[t._v("static global configuration")]),t._v(" and "),s("router-link",{attrs:{to:"/user-guide/kv-config/#dynamic-configuration-in-key-value-store"}},[t._v("dynamic")]),t._v(" configuration can be stored in a Key-value store.")],1),t._v(" "),s("p",[t._v("This section explains how to launch Traefik using a configuration loaded from a Key-value store.")]),t._v(" "),s("p",[t._v("Traefik supports several Key-value stores:")]),t._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"https://consul.io",target:"_blank",rel:"noopener noreferrer"}},[t._v("Consul"),s("OutboundLink")],1)]),t._v(" "),s("li",[s("a",{attrs:{href:"https://coreos.com/etcd/",target:"_blank",rel:"noopener noreferrer"}},[t._v("etcd"),s("OutboundLink")],1)]),t._v(" "),s("li",[s("a",{attrs:{href:"https://zookeeper.apache.org/",target:"_blank",rel:"noopener noreferrer"}},[t._v("ZooKeeper"),s("OutboundLink")],1)]),t._v(" "),s("li",[s("a",{attrs:{href:"https://github.com/boltdb/bolt",target:"_blank",rel:"noopener noreferrer"}},[t._v("boltdb"),s("OutboundLink")],1)])]),t._v(" "),t._m(1),t._v(" "),s("p",[t._v("We will see the steps to set it up with an easy example.")]),t._v(" "),t._m(2),t._v(" "),t._m(3),t._v(" "),s("p",[t._v("The Traefik global configuration will be retrieved from a "),s("a",{attrs:{href:"https://consul.io",target:"_blank",rel:"noopener noreferrer"}},[t._v("Consul"),s("OutboundLink")],1),t._v(" store.")]),t._v(" "),s("p",[t._v("First we have to launch Consul in a container.")]),t._v(" "),s("p",[t._v("The "),s("a",{attrs:{href:"https://docs.docker.com/compose/compose-file/",target:"_blank",rel:"noopener noreferrer"}},[t._v("docker-compose file"),s("OutboundLink")],1),t._v(" allows us to launch Consul and four instances of the trivial app "),s("a",{attrs:{href:"https://github.com/containous/whoami",target:"_blank",rel:"noopener noreferrer"}},[t._v("containous/whoami"),s("OutboundLink")],1),t._v(" :")]),t._v(" "),t._m(4),t._m(5),t._v(" "),s("p",[t._v("We should now fill the store with the Traefik global configuration."),s("br"),t._v("\nTo do that, we can send the Key-value pairs via "),s("a",{attrs:{href:"https://www.consul.io/intro/getting-started/kv.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("curl commands"),s("OutboundLink")],1),t._v(" or via the "),s("a",{attrs:{href:"https://www.consul.io/intro/getting-started/ui.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("Web UI"),s("OutboundLink")],1),t._v(".")]),t._v(" "),s("p",[t._v("Fortunately, Traefik allows automation of this process using the "),s("code",[t._v("storeconfig")]),t._v(" subcommand."),s("br"),t._v("\nPlease refer to the "),s("router-link",{attrs:{to:"/user-guide/kv-config/#store-configuration-in-key-value-store"}},[t._v("store Traefik configuration")]),t._v(" section to get documentation on it.")],1),t._v(" "),s("p",[t._v("Here is the toml configuration we would like to store in the Key-value Store  :")]),t._v(" "),t._m(6),t._m(7),t._v(" "),t._m(8),t._v(" "),s("p",[t._v("In case you are setting key values manually:")]),t._v(" "),t._m(9),t._v(" "),s("p",[t._v("Note that we can either give path to certificate file or directly the file content itself.")]),t._v(" "),t._m(10),t._v(" "),s("p",[t._v("We will now launch Traefik in a container.")]),t._v(" "),s("p",[t._v("We use CLI flags to setup the connection between Traefik and Consul.\nAll the rest of the global configuration is stored in Consul.")]),t._v(" "),s("p",[t._v("Here is the "),s("a",{attrs:{href:"https://docs.docker.com/compose/compose-file/",target:"_blank",rel:"noopener noreferrer"}},[t._v("docker-compose file"),s("OutboundLink")],1),t._v(" :")]),t._v(" "),t._m(11),t._m(12),t._v(" "),t._m(13),t._v(" "),t._m(14),t._v(" "),t._m(15),t._v(" "),s("p",[t._v("If a Consul ACL is used to restrict Traefik read/write access, one of the following configurations is needed.")]),t._v(" "),t._m(16),t._v(" "),t._m(17),t._m(18),t._v(" "),t._m(19),t._m(20),t._v(" "),t._m(21),t._v(" "),t._m(22),t._v(" "),t._m(23),t._v(" "),s("p",[t._v("So far, only "),s("a",{attrs:{href:"https://consul.io",target:"_blank",rel:"noopener noreferrer"}},[t._v("Consul"),s("OutboundLink")],1),t._v(" and "),s("a",{attrs:{href:"https://coreos.com/etcd/",target:"_blank",rel:"noopener noreferrer"}},[t._v("etcd"),s("OutboundLink")],1),t._v(" support TLS connections with client certificates.")]),t._v(" "),s("p",[t._v("To set it up, we should enable "),s("a",{attrs:{href:"https://www.consul.io/docs/internals/security.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("consul security"),s("OutboundLink")],1),t._v(" (or "),s("a",{attrs:{href:"https://coreos.com/etcd/docs/latest/security.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("etcd security"),s("OutboundLink")],1),t._v(").")]),t._v(" "),t._m(24),t._v(" "),t._m(25),t._v(" "),s("p",[t._v("Or etcd flags :")]),t._v(" "),t._m(26),t._v(" "),s("p",[t._v("!! note\nWe can either give directly directly the file content itself (instead of the path to certificate) in a TOML file configuration.")]),t._v(" "),t._m(27),t._v(" "),t._m(28),t._v(" "),s("p",[t._v("Following our example, we will provide backends/frontends  rules and HTTPS certificates to Traefik.")]),t._v(" "),t._m(29),t._v(" "),t._m(30),t._v(" "),s("p",[t._v("Here is the toml configuration we would like to store in the store :")]),t._v(" "),t._m(31),t._m(32),t._v(" "),t._m(33),t._v(" "),t._m(34),t._v(" "),t._m(35),t._v(" "),t._m(36),t._v(" "),t._m(37),t._v(" "),t._m(38),t._v(" "),t._m(39),t._v(" "),t._m(40),t._v(" "),t._m(41),t._v(" "),t._m(42),t._v(" "),t._m(43),t._v(" "),t._m(44),t._v(" "),t._m(45),t._v(" "),t._m(46),t._v(" "),s("p",[t._v("Traefik can watch the backends/frontends configuration changes and generate its configuration automatically.")]),t._v(" "),t._m(47),t._v(" "),s("p",[t._v("The "),s("a",{attrs:{href:"https://github.com/coreos/etcd/issues/860",target:"_blank",rel:"noopener noreferrer"}},[t._v("Etcd"),s("OutboundLink")],1),t._v(" and "),s("a",{attrs:{href:"https://github.com/hashicorp/consul/issues/886",target:"_blank",rel:"noopener noreferrer"}},[t._v("Consul"),s("OutboundLink")],1),t._v(" backends do not support updating multiple keys atomically."),s("br"),t._v("\nAs a result, it may be possible for Traefik to read an intermediate configuration state despite judicious use of the "),s("code",[t._v("--providersThrottleDuration")]),t._v(" flag."),s("br"),t._v("\nTo solve this problem, Traefik supports a special key called "),s("code",[t._v("/traefik/alias")]),t._v(".\nIf set, Traefik use the value as an alternative key prefix.")]),t._v(" "),t._m(48),t._v(" "),t._m(49),t._v(" "),s("p",[t._v("When an atomic configuration change is required, you may write a new configuration at an alternative prefix.")]),t._v(" "),t._m(50),t._v(" "),t._m(51),t._v(" "),t._m(52),t._v(" "),t._m(53),t._v(" "),t._m(54),t._v(" "),t._m(55),t._v(" "),t._m(56),t._v(" "),t._m(57),t._v(" "),s("p",[t._v("The static Traefik configuration in a key-value store can be automatically created and updated, using the "),s("router-link",{attrs:{to:"/basics/#commands"}},[s("code",[t._v("storeconfig")]),t._v(" subcommand")]),t._v(".")],1),t._v(" "),t._m(58),s("p",[t._v("This command is here only to automate the "),s("router-link",{attrs:{to:"/user-guide/kv-config/#upload-the-configuration-in-the-key-value-store"}},[t._v("process which upload the configuration into the Key-value store")]),t._v(".\nTraefik will not start but the "),s("router-link",{attrs:{to:"/basics/#static-traefik-configuration"}},[t._v("static configuration")]),t._v(" will be uploaded into the Key-value store.")],1),t._v(" "),s("p",[t._v("If you configured ACME (Let's Encrypt), your registration account and your certificates will also be uploaded.")]),t._v(" "),t._m(59),t._v(" "),t._m(60),t._v(" "),t._m(61),t._m(62),t._v(" "),s("p",[t._v("That's it!")]),t._v(" "),t._m(63)])},[function(){var t=this.$createElement,e=this._self._c||t;return e("h1",{attrs:{id:"key-value-store-configuration"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#key-value-store-configuration","aria-hidden":"true"}},[this._v("#")]),this._v(" Key-value store configuration")])},function(){var t=this.$createElement,e=this._self._c||t;return e("h2",{attrs:{id:"static-configuration-in-key-value-store"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#static-configuration-in-key-value-store","aria-hidden":"true"}},[this._v("#")]),this._v(" Static configuration in Key-value store")])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"tip custom-block"},[e("p",{staticClass:"custom-block-title"},[this._v("TIP")]),this._v(" "),e("pre",[e("code",[this._v("We could do the same with any other Key-value Store.\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h3",{attrs:{id:"docker-compose-file-for-consul"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#docker-compose-file-for-consul","aria-hidden":"true"}},[this._v("#")]),this._v(" docker-compose file for Consul")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("consul")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" progrium/consul\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("command")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("server "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("bootstrap "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("log"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("level debug "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("ui"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("dir /ui\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ports")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"8400:8400"')]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"8500:8500"')]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"8600:53/udp"')]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("expose")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"8300"')]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"8301"')]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"8301/udp"')]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"8302"')]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"8302/udp"')]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("whoami1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" containous/whoami\n\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("whoami2")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" containous/whoami\n\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("whoami3")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" containous/whoami\n\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("whoami4")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" containous/whoami\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h3",{attrs:{id:"upload-the-configuration-in-the-key-value-store"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#upload-the-configuration-in-the-key-value-store","aria-hidden":"true"}},[this._v("#")]),this._v(" Upload the configuration in the Key-value store")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"language-ini extra-class"},[s("pre",{pre:!0,attrs:{class:"language-ini"}},[s("code",[s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("logLevel")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(' "DEBUG"')]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("defaultEntryPoints")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(' ["http", "https"]')]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token selector"}},[t._v("[entryPoints]")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token selector"}},[t._v("  [entryPoints.api]")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("    address")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(' ":8081"')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token selector"}},[t._v("  [entryPoints.http]")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("  address")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(' ":80"')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token selector"}},[t._v("  [entryPoints.https]")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("  address")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(' ":443"')]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token selector"}},[t._v("    [entryPoints.https.tls]")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token selector"}},[t._v("      [[entryPoints.https.tls.certificates]")]),t._v("]\n"),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("      certFile")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(' "integration/fixtures/https/snitest.com.cert"')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("      keyFile")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(' "integration/fixtures/https/snitest.com.key"')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token selector"}},[t._v("      [[entryPoints.https.tls.certificates]")]),t._v("]\n"),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("      certFile")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(' """-----BEGIN CERTIFICATE-----')]),t._v('\n                      <cert file content>\n                      -----END CERTIFICATE-----"""\n'),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("      keyFile")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(' """-----BEGIN PRIVATE KEY-----')]),t._v('\n                      <key file content>\n                      -----END PRIVATE KEY-----"""\n'),s("span",{pre:!0,attrs:{class:"token selector"}},[t._v("    [entryPoints.other-https]")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("    address")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(' ":4443"')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token selector"}},[t._v("      [entryPoints.other-https.tls]")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token selector"}},[t._v("[consul]")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("  endpoint")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(' "127.0.0.1:8500"')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("  watch")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" true")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("  prefix")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(' "traefik"')]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token selector"}},[t._v("[api]")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("  entrypoint")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(' "api"')]),t._v("\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("And there, the same global configuration in the Key-value Store (using "),e("code",[this._v('prefix = "traefik"')]),this._v("):")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("table",[s("thead",[s("tr",[s("th",[t._v("Key")]),t._v(" "),s("th",[t._v("Value")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[s("code",[t._v("/traefik/loglevel")])]),t._v(" "),s("td",[s("code",[t._v("DEBUG")])])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("/traefik/defaultentrypoints/0")])]),t._v(" "),s("td",[s("code",[t._v("http")])])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("/traefik/defaultentrypoints/1")])]),t._v(" "),s("td",[s("code",[t._v("https")])])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("/traefik/entrypoints/api/address")])]),t._v(" "),s("td",[s("code",[t._v(":8081")])])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("/traefik/entrypoints/http/address")])]),t._v(" "),s("td",[s("code",[t._v(":80")])])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("/traefik/entrypoints/https/address")])]),t._v(" "),s("td",[s("code",[t._v(":443")])])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("/traefik/entrypoints/https/tls/certificates/0/certfile")])]),t._v(" "),s("td",[s("code",[t._v("integration/fixtures/https/snitest.com.cert")])])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("/traefik/entrypoints/https/tls/certificates/0/keyfile")])]),t._v(" "),s("td",[s("code",[t._v("integration/fixtures/https/snitest.com.key")])])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("/traefik/entrypoints/https/tls/certificates/1/certfile")])]),t._v(" "),s("td",[s("code",[t._v("--BEGIN CERTIFICATE--<cert file content>--END CERTIFICATE--")])])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("/traefik/entrypoints/https/tls/certificates/1/keyfile")])]),t._v(" "),s("td",[s("code",[t._v("--BEGIN CERTIFICATE--<key file content>--END CERTIFICATE--")])])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("/traefik/entrypoints/other-https/address")])]),t._v(" "),s("td",[s("code",[t._v(":4443")])])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("/traefik/consul/endpoint")])]),t._v(" "),s("td",[s("code",[t._v("127.0.0.1:8500")])])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("/traefik/consul/watch")])]),t._v(" "),s("td",[s("code",[t._v("true")])])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("/traefik/consul/prefix")])]),t._v(" "),s("td",[s("code",[t._v("traefik")])])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("/traefik/api/entrypoint")])]),t._v(" "),s("td",[s("code",[t._v("api")])])])])])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("ul",[s("li",[t._v("Remember to specify the indexes ("),s("code",[t._v("0")]),t._v(","),s("code",[t._v("1")]),t._v(", "),s("code",[t._v("2")]),t._v(", ... ) under prefixes "),s("code",[t._v("/traefik/defaultentrypoints/")]),t._v(" and "),s("code",[t._v("/traefik/entrypoints/https/tls/certificates/")]),t._v(" in order to match the global configuration structure.")]),t._v(" "),s("li",[t._v("Be careful to give the correct IP address and port on the key "),s("code",[t._v("/traefik/consul/endpoint")]),t._v(".")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h3",{attrs:{id:"launch-traefik"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#launch-traefik","aria-hidden":"true"}},[this._v("#")]),this._v(" Launch Traefik")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("traefik")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" traefik\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("command")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("consul "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("consul.endpoint=127.0.0.1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("8500")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ports")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"80:80"')]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"8080:8080"')]),t._v("\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("!!! warning\nBe careful to give the correct IP address and port in the flag "),e("code",[this._v("--consul.endpoint")]),this._v(".")])},function(){var t=this.$createElement,e=this._self._c||t;return e("h3",{attrs:{id:"consul-acl-token-support"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#consul-acl-token-support","aria-hidden":"true"}},[this._v("#")]),this._v(" Consul ACL Token support")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("To specify a Consul ACL token for Traefik, we have to set a System Environment variable named "),e("code",[this._v("CONSUL_HTTP_TOKEN")]),this._v(" prior to starting Traefik.\nThis variable must be initialized with the ACL token value.")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("If Traefik is launched into a Docker container, the variable "),e("code",[this._v("CONSUL_HTTP_TOKEN")]),this._v(" can be initialized with the "),e("code",[this._v("-e")]),this._v(" Docker option : "),e("code",[this._v('-e "CONSUL_HTTP_TOKEN=[consul-acl-token-value]"')])])},function(){var t=this.$createElement,e=this._self._c||t;return e("ul",[e("li",[this._v("HCL format :")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v('    key "traefik" {\n        policy = "write"\n    },\n\n    session "" {\n        policy = "write"\n    }\n')])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("ul",[e("li",[this._v("JSON format :")])])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"language-json extra-class"},[s("pre",{pre:!0,attrs:{class:"language-json"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"key"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"traefik"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n          "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"policy"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"write"')]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"session"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('""')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"policy"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"write"')]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h3",{attrs:{id:"tls-support"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#tls-support","aria-hidden":"true"}},[this._v("#")]),this._v(" TLS support")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("To connect to a Consul endpoint using SSL, simply specify "),e("code",[this._v("https://")]),this._v(" in the "),e("code",[this._v("consul.endpoint")]),this._v(" property")])},function(){var t=this.$createElement,e=this._self._c||t;return e("ul",[e("li",[e("code",[this._v("--consul.endpoint=https://[consul-host]:[consul-ssl-port]")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h3",{attrs:{id:"tls-support-with-client-certificates"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#tls-support-with-client-certificates","aria-hidden":"true"}},[this._v("#")]),this._v(" TLS support with client certificates")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("Then, we have to provide CA, Cert and Key to Traefik using "),e("code",[this._v("consul")]),this._v(" flags :")])},function(){var t=this.$createElement,e=this._self._c||t;return e("ul",[e("li",[e("code",[this._v("--consul.tls")])]),this._v(" "),e("li",[e("code",[this._v("--consul.tls.ca=path/to/the/file")])]),this._v(" "),e("li",[e("code",[this._v("--consul.tls.cert=path/to/the/file")])]),this._v(" "),e("li",[e("code",[this._v("--consul.tls.key=path/to/the/file")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("ul",[e("li",[e("code",[this._v("--etcd.tls")])]),this._v(" "),e("li",[e("code",[this._v("--etcd.tls.ca=path/to/the/file")])]),this._v(" "),e("li",[e("code",[this._v("--etcd.tls.cert=path/to/the/file")])]),this._v(" "),e("li",[e("code",[this._v("--etcd.tls.key=path/to/the/file")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("Remember the command "),e("code",[this._v("traefik --help")]),this._v(" to display the updated list of flags.")])},function(){var t=this.$createElement,e=this._self._c||t;return e("h2",{attrs:{id:"dynamic-configuration-in-key-value-store"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#dynamic-configuration-in-key-value-store","aria-hidden":"true"}},[this._v("#")]),this._v(" Dynamic configuration in Key-value store")])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"tip custom-block"},[e("p",{staticClass:"custom-block-title"},[this._v("TIP")]),this._v(" "),e("pre",[e("code",[this._v("This section is independent of the way Traefik got its static configuration.\nIt means that the static configuration can either come from the same Key-value store or from any other sources.\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h3",{attrs:{id:"key-value-storage-structure"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#key-value-storage-structure","aria-hidden":"true"}},[this._v("#")]),this._v(" Key-value storage structure")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"language-ini extra-class"},[s("pre",{pre:!0,attrs:{class:"language-ini"}},[s("code",[s("span",{pre:!0,attrs:{class:"token selector"}},[t._v("[file]")]),t._v("\n\n# rules\n"),s("span",{pre:!0,attrs:{class:"token selector"}},[t._v("[backends]")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token selector"}},[t._v("  [backends.backend1]")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token selector"}},[t._v("    [backends.backend1.circuitbreaker]")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("    expression")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(' "NetworkErrorRatio() > 0.5"')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token selector"}},[t._v("    [backends.backend1.servers.server1]")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("    url")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(' "http://172.17.0.2:80"')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("    weight")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" 10")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token selector"}},[t._v("    [backends.backend1.servers.server2]")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("    url")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(' "http://172.17.0.3:80"')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("    weight")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" 1")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token selector"}},[t._v("  [backends.backend2]")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token selector"}},[t._v("    [backends.backend1.maxconn]")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("    amount")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" 10")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("    extractorfunc")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(' "request.host"')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token selector"}},[t._v("    [backends.backend2.LoadBalancer]")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("    method")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(' "drr"')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token selector"}},[t._v("    [backends.backend2.servers.server1]")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("    url")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(' "http://172.17.0.4:80"')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("    weight")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" 1")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token selector"}},[t._v("    [backends.backend2.servers.server2]")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("    url")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(' "http://172.17.0.5:80"')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("    weight")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" 2")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token selector"}},[t._v("[frontends]")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token selector"}},[t._v("  [frontends.frontend1]")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("  backend")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(' "backend2"')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token selector"}},[t._v("    [frontends.frontend1.routes.test_1]")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("    rule")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(' "Host:test.localhost"')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token selector"}},[t._v("  [frontends.frontend2]")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("  backend")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(' "backend1"')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("  passHostHeader")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" true")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("  priority")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" 10")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token selector"}},[t._v("      [frontends.frontend2.auth.basic]")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("      users")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" [")]),t._v('\n        "test:$apr1$H6uskkkW$IgXLP6ewTrSuBkTrqE8wj/",\n        "test2:$apr1$d9hr9HBB$4HxwgUir3HP4EsggP/QNo0",\n      ]\n'),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("  entrypoints")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(' ["https"] # overrides defaultEntryPoints')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token selector"}},[t._v("    [frontends.frontend2.routes.test_1]")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("    rule")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(' "Host:{subdomain:[a-z]+}.localhost"')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token selector"}},[t._v("  [frontends.frontend3]")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("  entrypoints")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(' ["http", "https"] # overrides defaultEntryPoints')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("  backend")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(' "backend2"')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("  rule")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(' "Path:/test"')]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token selector"}},[t._v("[[tls]")]),t._v("]\n"),s("span",{pre:!0,attrs:{class:"token selector"}},[t._v("  [tls.certificate]")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("    certFile")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(' "path/to/your.cert"')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("    keyFile")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(' "path/to/your.key"')]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token selector"}},[t._v("[[tls]")]),t._v("]\n"),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("  entryPoints")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(' ["https","other-https"]')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token selector"}},[t._v("  [tls.certificate]")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("    certFile")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(' """-----BEGIN CERTIFICATE-----')]),t._v('\n                      <cert file content>\n                      -----END CERTIFICATE-----"""\n'),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("    keyFile")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(' """-----BEGIN CERTIFICATE-----')]),t._v('\n                      <key file content>\n                      -----END CERTIFICATE-----"""\n')])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("And there, the same dynamic configuration in a KV Store (using "),e("code",[this._v('prefix = "traefik"')]),this._v("):")])},function(){var t=this.$createElement,e=this._self._c||t;return e("ul",[e("li",[this._v("backend 1")])])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("table",[s("thead",[s("tr",[s("th",[t._v("Key")]),t._v(" "),s("th",[t._v("Value")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[s("code",[t._v("/traefik/backends/backend1/circuitbreaker/expression")])]),t._v(" "),s("td",[s("code",[t._v("NetworkErrorRatio() > 0.5")])])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("/traefik/backends/backend1/servers/server1/url")])]),t._v(" "),s("td",[s("code",[t._v("http://172.17.0.2:80")])])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("/traefik/backends/backend1/servers/server1/weight")])]),t._v(" "),s("td",[s("code",[t._v("10")])])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("/traefik/backends/backend1/servers/server2/url")])]),t._v(" "),s("td",[s("code",[t._v("http://172.17.0.3:80")])])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("/traefik/backends/backend1/servers/server2/weight")])]),t._v(" "),s("td",[s("code",[t._v("1")])])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("/traefik/backends/backend1/servers/server2/tags")])]),t._v(" "),s("td",[s("code",[t._v("api,helloworld")])])])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("ul",[e("li",[this._v("backend 2")])])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("table",[s("thead",[s("tr",[s("th",[t._v("Key")]),t._v(" "),s("th",[t._v("Value")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[s("code",[t._v("/traefik/backends/backend2/maxconn/amount")])]),t._v(" "),s("td",[s("code",[t._v("10")])])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("/traefik/backends/backend2/maxconn/extractorfunc")])]),t._v(" "),s("td",[s("code",[t._v("request.host")])])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("/traefik/backends/backend2/loadbalancer/method")])]),t._v(" "),s("td",[s("code",[t._v("drr")])])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("/traefik/backends/backend2/servers/server1/url")])]),t._v(" "),s("td",[s("code",[t._v("http://172.17.0.4:80")])])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("/traefik/backends/backend2/servers/server1/weight")])]),t._v(" "),s("td",[s("code",[t._v("1")])])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("/traefik/backends/backend2/servers/server2/url")])]),t._v(" "),s("td",[s("code",[t._v("http://172.17.0.5:80")])])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("/traefik/backends/backend2/servers/server2/weight")])]),t._v(" "),s("td",[s("code",[t._v("2")])])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("/traefik/backends/backend2/servers/server2/tags")])]),t._v(" "),s("td",[s("code",[t._v("web")])])])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("ul",[e("li",[this._v("frontend 1")])])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("table",[s("thead",[s("tr",[s("th",[t._v("Key")]),t._v(" "),s("th",[t._v("Value")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[s("code",[t._v("/traefik/frontends/frontend1/backend")])]),t._v(" "),s("td",[s("code",[t._v("backend2")])])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("/traefik/frontends/frontend1/routes/test_1/rule")])]),t._v(" "),s("td",[s("code",[t._v("Host:test.localhost")])])])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("ul",[e("li",[this._v("frontend 2")])])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("table",[s("thead",[s("tr",[s("th",[t._v("Key")]),t._v(" "),s("th",[t._v("Value")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[s("code",[t._v("/traefik/frontends/frontend2/backend")])]),t._v(" "),s("td",[s("code",[t._v("backend1")])])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("/traefik/frontends/frontend2/passhostheader")])]),t._v(" "),s("td",[s("code",[t._v("true")])])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("/traefik/frontends/frontend2/priority")])]),t._v(" "),s("td",[s("code",[t._v("10")])])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("/traefik/frontends/frontend2/auth/basic/users/0")])]),t._v(" "),s("td",[s("code",[t._v("test:$apr1$H6uskkkW$IgXLP6ewTrSuBkTrqE8wj/")])])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("/traefik/frontends/frontend2/auth/basic/users/1")])]),t._v(" "),s("td",[s("code",[t._v("test2:$apr1$d9hr9HBB$4HxwgUir3HP4EsggP/QNo0")])])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("/traefik/frontends/frontend2/entrypoints")])]),t._v(" "),s("td",[s("code",[t._v("http,https")])])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("/traefik/frontends/frontend2/routes/test_2/rule")])]),t._v(" "),s("td",[s("code",[t._v("PathPrefix:/test")])])])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("ul",[e("li",[this._v("certificate 1")])])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("table",[s("thead",[s("tr",[s("th",[t._v("Key")]),t._v(" "),s("th",[t._v("Value")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[s("code",[t._v("/traefik/tls/1/certificate/certfile")])]),t._v(" "),s("td",[s("code",[t._v("path/to/your.cert")])])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("/traefik/tls/1/certificate/keyfile")])]),t._v(" "),s("td",[s("code",[t._v("path/to/your.key")])])])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"tip custom-block"},[e("p",{staticClass:"custom-block-title"},[this._v("TIP")]),this._v(" "),e("pre",[e("code",[this._v("As `/traefik/tls/1/entrypoints` is not defined, the certificate will be attached to all `defaulEntryPoints` with a TLS configuration (in the example, the entryPoint `https`)\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("ul",[e("li",[this._v("certificate 2")])])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("table",[s("thead",[s("tr",[s("th",[t._v("Key")]),t._v(" "),s("th",[t._v("Value")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[s("code",[t._v("/traefik/tls/2/entrypoints")])]),t._v(" "),s("td",[s("code",[t._v("https,other-https")])])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("/traefik/tls/2/certificate/certfile")])]),t._v(" "),s("td",[s("code",[t._v("<cert file content>")])])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("/traefik/tls/2/certificate/keyfile")])]),t._v(" "),s("td",[s("code",[t._v("<key file content>")])])])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h3",{attrs:{id:"atomic-configuration-changes"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#atomic-configuration-changes","aria-hidden":"true"}},[this._v("#")]),this._v(" Atomic configuration changes")])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"tip custom-block"},[e("p",{staticClass:"custom-block-title"},[this._v("TIP")]),this._v(" "),e("pre",[e("code",[this._v("Only backends/frontends rules are dynamic, the rest of the Traefik configuration stay static.\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("Given the key structure below, Traefik will use the "),e("code",[this._v("http://172.17.0.2:80")]),this._v(" as its only backend (frontend keys have been omitted for brevity).")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("table",[s("thead",[s("tr",[s("th",[t._v("Key")]),t._v(" "),s("th",[t._v("Value")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[s("code",[t._v("/traefik/alias")])]),t._v(" "),s("td",[s("code",[t._v("/traefik_configurations/1")])])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("/traefik_configurations/1/backends/backend1/servers/server1/url")])]),t._v(" "),s("td",[s("code",[t._v("http://172.17.0.2:80")])])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("/traefik_configurations/1/backends/backend1/servers/server1/weight")])]),t._v(" "),s("td",[s("code",[t._v("10")])])])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("Here, although the "),e("code",[this._v("/traefik_configurations/2/...")]),this._v(" keys have been set, the old configuration is still active because the "),e("code",[this._v("/traefik/alias")]),this._v(" key still points to "),e("code",[this._v("/traefik_configurations/1")]),this._v(":")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("table",[s("thead",[s("tr",[s("th",[t._v("Key")]),t._v(" "),s("th",[t._v("Value")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[s("code",[t._v("/traefik/alias")])]),t._v(" "),s("td",[s("code",[t._v("/traefik_configurations/1")])])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("/traefik_configurations/1/backends/backend1/servers/server1/url")])]),t._v(" "),s("td",[s("code",[t._v("http://172.17.0.2:80")])])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("/traefik_configurations/1/backends/backend1/servers/server1/weight")])]),t._v(" "),s("td",[s("code",[t._v("10")])])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("/traefik_configurations/2/backends/backend1/servers/server1/url")])]),t._v(" "),s("td",[s("code",[t._v("http://172.17.0.2:80")])])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("/traefik_configurations/2/backends/backend1/servers/server1/weight")])]),t._v(" "),s("td",[s("code",[t._v("5")])])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("/traefik_configurations/2/backends/backend1/servers/server2/url")])]),t._v(" "),s("td",[s("code",[t._v("http://172.17.0.3:80")])])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("/traefik_configurations/2/backends/backend1/servers/server2/weight")])]),t._v(" "),s("td",[s("code",[t._v("5")])])])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("Once the "),e("code",[this._v("/traefik/alias")]),this._v(" key is updated, the new "),e("code",[this._v("/traefik_configurations/2")]),this._v(" configuration becomes active atomically.")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("Here, we have a 50% balance between the "),e("code",[this._v("http://172.17.0.3:80")]),this._v(" and the "),e("code",[this._v("http://172.17.0.4:80")]),this._v(" hosts while no traffic is sent to the "),e("code",[this._v("172.17.0.2:80")]),this._v(" host:")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("table",[s("thead",[s("tr",[s("th",[t._v("Key")]),t._v(" "),s("th",[t._v("Value")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[s("code",[t._v("/traefik/alias")])]),t._v(" "),s("td",[s("code",[t._v("/traefik_configurations/2")])])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("/traefik_configurations/1/backends/backend1/servers/server1/url")])]),t._v(" "),s("td",[s("code",[t._v("http://172.17.0.2:80")])])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("/traefik_configurations/1/backends/backend1/servers/server1/weight")])]),t._v(" "),s("td",[s("code",[t._v("10")])])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("/traefik_configurations/2/backends/backend1/servers/server1/url")])]),t._v(" "),s("td",[s("code",[t._v("http://172.17.0.3:80")])])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("/traefik_configurations/2/backends/backend1/servers/server1/weight")])]),t._v(" "),s("td",[s("code",[t._v("5")])])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("/traefik_configurations/2/backends/backend1/servers/server2/url")])]),t._v(" "),s("td",[s("code",[t._v("http://172.17.0.4:80")])])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("/traefik_configurations/2/backends/backend1/servers/server2/weight")])]),t._v(" "),s("td",[s("code",[t._v("5")])])])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"tip custom-block"},[e("p",{staticClass:"custom-block-title"},[this._v("TIP")]),this._v(" "),e("pre",[e("code",[this._v("Traefik *will not watch for key changes in the `/traefik_configurations` prefix*. It will only watch for changes in the `/traefik/alias`.  \nFurther, if the `/traefik/alias` key is set, all other configuration with `/traefik/backends` or `/traefik/frontends` prefix are ignored.\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h2",{attrs:{id:"store-configuration-in-key-value-store"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#store-configuration-in-key-value-store","aria-hidden":"true"}},[this._v("#")]),this._v(" Store configuration in Key-value store")])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"tip custom-block"},[e("p",{staticClass:"custom-block-title"},[this._v("TIP")]),this._v(" "),e("pre",[e("code",[this._v("Don't forget to [setup the connection between Traefik and Key-value store](/user-guide/kv-config/#launch-traefik).\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[this._v("traefik storeconfig "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[this._v("[")]),this._v("flags"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[this._v("]")]),this._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[this._v("..")]),this._v(".\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("If you configured a file provider "),e("code",[this._v("[file]")]),this._v(", all your dynamic configuration (backends, frontends...) will be uploaded to the Key-value store.")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("To upload your ACME certificates to the KV store, get your Traefik TOML file and add the new "),e("code",[this._v("storage")]),this._v(" option in the "),e("code",[this._v("acme")]),this._v(" section:")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"language-ini extra-class"},[s("pre",{pre:!0,attrs:{class:"language-ini"}},[s("code",[s("span",{pre:!0,attrs:{class:"token selector"}},[t._v("[acme]")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("email")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(' "test@traefik.io"')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("storage")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(' "traefik/acme/account" # the key where to store your certificates in the KV store')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("storageFile")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(' "acme.json" # your old certificates store')]),t._v("\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("Call "),e("code",[this._v("traefik storeconfig")]),this._v(" to upload your config in the KV store.\nThen remove the line "),e("code",[this._v('storageFile = "acme.json"')]),this._v(" from your TOML config file.")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[e("img",{attrs:{src:"https://i.giphy.com/ujUdrdpX7Ok5W.gif",alt:"GIF Magica"}})])}],!1,null,null,null);e.default=n.exports}}]);