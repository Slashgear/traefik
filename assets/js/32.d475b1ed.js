(window.webpackJsonp=window.webpackJsonp||[]).push([[32],{203:function(t,e,s){"use strict";s.r(e);var a=s(0),n=Object(a.a)({},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"content"},[t._m(0),t._v(" "),t._m(1),t._v(" "),t._m(2),t._v(" "),s("p",[t._v("In addition, we want to use Let's Encrypt to automatically generate and renew SSL certificates per hostname.")]),t._v(" "),t._m(3),t._v(" "),s("p",[t._v("In order for this to work, you'll need a server with a public IP address, with Docker and docker-compose installed on it.")]),t._v(" "),t._m(4),t._v(" "),s("p",[t._v("In real-life, you'll want to use your own domain and have the DNS configured accordingly so the hostname records you'll want to use point to the aforementioned public IP address.")]),t._v(" "),t._m(5),t._v(" "),t._m(6),t._v(" "),t._m(7),t._v(" "),s("p",[t._v("On the Docker host, run the following command:")]),t._v(" "),t._m(8),s("p",[t._v("Now, let's create a directory on the server where we will configure the rest of Traefik:")]),t._v(" "),t._m(9),s("p",[t._v("Within this directory, we're going to create 3 empty files:")]),t._v(" "),t._m(10),t._m(11),t._v(" "),s("p",[t._v("The contents of the file is as follows:")]),t._v(" "),t._m(12),t._m(13),t._v(" "),t._m(14),t._v(" "),t._m(15),s("p",[t._v("This is the minimum configuration required to do the following:")]),t._v(" "),t._m(16),t._v(" "),t._m(17),t._v(" "),t._m(18),t._v(" "),s("p",[t._v("Now that we've fully configured and started Traefik, it's time to get our applications running!")]),t._v(" "),s("p",[t._v("Let's take a simple example of a micro-service project consisting of various services, where some will be exposed to the outside world and some will not.")]),t._v(" "),t._m(19),t._v(" "),t._m(20),t._m(21),t._v(" "),t._m(22),t._v(" "),t._m(23),t._v(" "),s("p",[t._v("As mentioned earlier, we don't want containers exposed automatically by Traefik.")]),t._v(" "),s("p",[t._v("The reason behind this is simple: we want to have control over this process ourselves.\nThanks to Docker labels, we can tell Traefik how to create its internal routing configuration.")]),t._v(" "),t._m(24),t._v(" "),t._m(25),t._m(26),t._v(" "),t._m(27),t._v(" "),t._m(28),t._v(" "),t._m(29),t._v(" "),t._m(30),t._v(" "),t._m(31),t._v(" "),t._m(32),t._v(" "),t._m(33),t._v(" "),t._m(34),t._v(" "),t._m(35),t._v(" "),t._m(36),t._v(" "),t._m(37),t._v(" "),s("ul",[t._m(38),t._v(" "),t._m(39),t._v(" "),t._m(40),t._v(" "),s("li",[t._v("Traefik has built-in support to automatically export "),s("a",{attrs:{href:"https://prometheus.io",target:"_blank",rel:"noopener noreferrer"}},[t._v("Prometheus"),s("OutboundLink")],1),t._v(" metrics")]),t._v(" "),t._m(41)]),t._v(" "),t._m(42),t._v(" "),s("p",[t._v("Using Traefik as a Layer-7 load balancer in combination with both Docker and Let's Encrypt provides you with an extremely flexible, powerful and self-configuring solution for your projects.")]),t._v(" "),s("p",[t._v("With Let's Encrypt, your endpoints are automatically secured with production-ready SSL certificates that are renewed automatically as well.")])])},[function(){var t=this.$createElement,e=this._self._c||t;return e("h1",{attrs:{id:"let-s-encrypt-docker"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#let-s-encrypt-docker","aria-hidden":"true"}},[this._v("#")]),this._v(" Let's Encrypt & Docker")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("In this use case, we want to use Traefik as a "),e("em",[this._v("layer-7")]),this._v(" load balancer with SSL termination for a set of micro-services used to run a web application.")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("We also want to automatically "),e("em",[this._v("discover any services")]),this._v(" on the Docker host and let Traefik reconfigure itself automatically when containers get created (or shut down) so HTTP traffic can be routed accordingly.")])},function(){var t=this.$createElement,e=this._self._c||t;return e("h2",{attrs:{id:"setting-up"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#setting-up","aria-hidden":"true"}},[this._v("#")]),this._v(" Setting Up")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("In this example, we're using the fictitious domain "),e("em",[this._v("my-awesome-app.org")]),this._v(".")])},function(){var t=this.$createElement,e=this._self._c||t;return e("h2",{attrs:{id:"networking"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#networking","aria-hidden":"true"}},[this._v("#")]),this._v(" Networking")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("Docker containers can only communicate with each other over TCP when they share at least one network.\nThis makes sense from a topological point of view in the context of networking, since Docker under the hood creates IPTable rules so containers can't reach other containers "),e("em",[this._v("unless you'd want to")]),this._v(".")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("In this example, we're going to use a single network called "),e("code",[this._v("web")]),this._v(" where all containers that are handling HTTP traffic (including Traefik) will reside in.")])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[this._v("docker network create web\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[this._v("mkdir")]),this._v(" -p /opt/traefik\n")])])])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("touch")]),t._v(" /opt/traefik/docker-compose.yml\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("touch")]),t._v(" /opt/traefik/acme.json "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("chmod")]),t._v(" 600 /opt/traefik/acme.json\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("touch")]),t._v(" /opt/traefik/traefik.toml\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("The "),e("code",[this._v("docker-compose.yml")]),this._v(" file will provide us with a simple, consistent and more importantly, a deterministic way to create Traefik.")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("version")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'2'")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("services")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("traefik")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" traefik"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("1.5.4\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("restart")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" always\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ports")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token datetime number"}},[t._v("80:80")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" 443"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("443")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("networks")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" web\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("volumes")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" /var/run/docker.sock"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("/var/run/docker.sock\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" /opt/traefik/traefik.toml"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("/traefik.toml\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" /opt/traefik/acme.json"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("/acme.json\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("container_name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" traefik\n\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("networks")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("web")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("external")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n")])])])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("p",[t._v("As you can see, we're mounting the "),s("code",[t._v("traefik.toml")]),t._v(" file as well as the (empty) "),s("code",[t._v("acme.json")]),t._v(" file in the container."),s("br"),t._v("\nAlso, we're mounting the "),s("code",[t._v("/var/run/docker.sock")]),t._v(" Docker socket in the container as well, so Traefik can listen to Docker events and reconfigure its own internal configuration when containers are created (or shut down)."),s("br"),t._v("\nAlso, we're making sure the container is automatically restarted by the Docker engine in case of problems (or: if the server is rebooted).\nWe're publishing the default HTTP ports "),s("code",[t._v("80")]),t._v(" and "),s("code",[t._v("443")]),t._v(" on the host, and making sure the container is placed within the "),s("code",[t._v("web")]),t._v(" network we've created earlier on."),s("br"),t._v("\nFinally, we're giving this container a static name called "),s("code",[t._v("traefik")]),t._v(".")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("Let's take a look at a simple "),e("code",[this._v("traefik.toml")]),this._v(" configuration as well before we'll create the Traefik container:")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"language-ini extra-class"},[s("pre",{pre:!0,attrs:{class:"language-ini"}},[s("code",[s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("debug")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" false")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("logLevel")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(' "ERROR"')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("defaultEntryPoints")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(' ["https","http"]')]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token selector"}},[t._v("[entryPoints]")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token selector"}},[t._v("  [entryPoints.http]")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("  address")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(' ":80"')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token selector"}},[t._v("    [entryPoints.http.redirect]")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("    entryPoint")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(' "https"')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token selector"}},[t._v("  [entryPoints.https]")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("  address")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(' ":443"')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token selector"}},[t._v("  [entryPoints.https.tls]")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token selector"}},[t._v("[retry]")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token selector"}},[t._v("[docker]")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("endpoint")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(' "unix:///var/run/docker.sock"')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("domain")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(' "my-awesome-app.org"')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("watch")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" true")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("exposedByDefault")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" false")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token selector"}},[t._v("[acme]")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("email")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(' "your-email-here@my-awesome-app.org"')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("storage")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(' "acme.json"')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("entryPoint")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(' "https"')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("onHostRule")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" true")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token selector"}},[t._v("[acme.httpChallenge]")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("entryPoint")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(' "http"')]),t._v("\n")])])])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("ul",[s("li",[t._v("Log "),s("code",[t._v("ERROR")]),t._v("-level messages (or more severe) to the console, but silence "),s("code",[t._v("DEBUG")]),t._v("-level messages")]),t._v(" "),s("li",[t._v("Check for new versions of Traefik periodically")]),t._v(" "),s("li",[t._v("Create two entry points, namely an "),s("code",[t._v("HTTP")]),t._v(" endpoint on port "),s("code",[t._v("80")]),t._v(", and an "),s("code",[t._v("HTTPS")]),t._v(" endpoint on port "),s("code",[t._v("443")]),t._v(" where all incoming traffic on port "),s("code",[t._v("80")]),t._v(" will immediately get redirected to "),s("code",[t._v("HTTPS")]),t._v(".")]),t._v(" "),s("li",[t._v("Enable the Docker provider and listen for container events on the Docker unix socket we've mounted earlier. However, "),s("strong",[t._v("new containers will not be exposed by Traefik by default, we'll get into this in a bit!")])]),t._v(" "),s("li",[t._v("Enable automatic request and configuration of SSL certificates using Let's Encrypt.\nThese certificates will be stored in the "),s("code",[t._v("acme.json")]),t._v(" file, which you can back-up yourself and store off-premises.")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("Alright, let's boot the container. From the "),e("code",[this._v("/opt/traefik")]),this._v(" directory, run "),e("code",[this._v("docker-compose up -d")]),this._v(" which will create and start the Traefik container.")])},function(){var t=this.$createElement,e=this._self._c||t;return e("h2",{attrs:{id:"exposing-web-services-to-the-outside-world"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#exposing-web-services-to-the-outside-world","aria-hidden":"true"}},[this._v("#")]),this._v(" Exposing Web Services to the Outside World")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("The "),e("code",[this._v("docker-compose.yml")]),this._v(" of our project looks like this:")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("version")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"2.1"')]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("services")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("app")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" my"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("docker"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("registry.com/my"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("awesome"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("app/app"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("latest\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("depends_on")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("db")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("condition")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" service_healthy\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("redis")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("condition")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" service_healthy\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("restart")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" always\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("networks")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" web\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" default\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("expose")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"9000"')]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("labels")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"traefik.docker.network=web"')]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"traefik.enable=true"')]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"traefik.basic.frontend.rule=Host:app.my-awesome-app.org"')]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"traefik.basic.port=9000"')]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"traefik.basic.protocol=http"')]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"traefik.admin.frontend.rule=Host:admin-app.my-awesome-app.org"')]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"traefik.admin.protocol=https"')]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"traefik.admin.port=9443"')]),t._v("\n\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("db")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" my"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("docker"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("registry.com/back"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("end/5.7\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("restart")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" always\n\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("redis")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" my"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("docker"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("registry.com/back"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("end/redis"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("4"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("alpine\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("restart")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" always\n\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("events")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" my"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("docker"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("registry.com/my"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("awesome"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("app/events"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("latest\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("depends_on")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("db")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("condition")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" service_healthy\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("redis")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("condition")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" service_healthy\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("restart")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" always\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("networks")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" web\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" default\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("expose")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"3000"')]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("labels")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"traefik.backend=my-awesome-app-events"')]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"traefik.docker.network=web"')]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"traefik.frontend.rule=Host:events.my-awesome-app.org"')]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"traefik.enable=true"')]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"traefik.port=3000"')]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("networks")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("web")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("external")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("Here, we can see a set of services with two applications that we're actually exposing to the outside world."),e("br"),this._v("\nNotice how there isn't a single container that has any published ports to the host -- everything is routed through Docker networks."),e("br"),this._v("\nAlso, only the containers that we want traffic to get routed to are attached to the "),e("code",[this._v("web")]),this._v(" network we created at the start of this document.")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("Since the "),e("code",[this._v("traefik")]),this._v(" container we've created and started earlier is also attached to this network, HTTP requests can now get routed to these containers.")])},function(){var t=this.$createElement,e=this._self._c||t;return e("h3",{attrs:{id:"labels"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#labels","aria-hidden":"true"}},[this._v("#")]),this._v(" Labels")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("Let's take a look at the labels themselves for the "),e("code",[this._v("app")]),this._v(" service, which is a HTTP webservice listing on port 9000:")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"traefik.docker.network=web"')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"traefik.enable=true"')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"traefik.basic.frontend.rule=Host:app.my-awesome-app.org"')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"traefik.basic.port=9000"')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"traefik.basic.protocol=http"')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"traefik.admin.frontend.rule=Host:admin-app.my-awesome-app.org"')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"traefik.admin.protocol=https"')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"traefik.admin.port=9443"')]),t._v("\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("We use both "),e("code",[this._v("container labels")]),this._v(" and "),e("code",[this._v("service labels")]),this._v(".")])},function(){var t=this.$createElement,e=this._self._c||t;return e("h4",{attrs:{id:"container-labels"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#container-labels","aria-hidden":"true"}},[this._v("#")]),this._v(" Container labels")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("First, we specify the "),e("code",[this._v("backend")]),this._v(" name which corresponds to the actual service we're routing "),e("strong",[this._v("to")]),this._v(".")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("We also tell Traefik to use the "),e("code",[this._v("web")]),this._v(" network to route HTTP traffic to this container.\nWith the "),e("code",[this._v("traefik.enable")]),this._v(" label, we tell Traefik to include this container in its internal configuration.")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("With the "),e("code",[this._v("frontend.rule")]),this._v(" label, we tell Traefik that we want to route to this container if the incoming HTTP request contains the "),e("code",[this._v("Host")]),this._v(" "),e("code",[this._v("app.my-awesome-app.org")]),this._v(".\nEssentially, this is the actual rule used for Layer-7 load balancing.")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("Finally but not unimportantly, we tell Traefik to route "),e("strong",[this._v("to")]),this._v(" port "),e("code",[this._v("9000")]),this._v(", since that is the actual TCP/IP port the container actually listens on.")])},function(){var t=this.$createElement,e=this._self._c||t;return e("h3",{attrs:{id:"service-labels"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#service-labels","aria-hidden":"true"}},[this._v("#")]),this._v(" Service labels")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[e("code",[this._v("Service labels")]),this._v(" allow managing many routes for the same container.")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("p",[t._v("When both "),s("code",[t._v("container labels")]),t._v(" and "),s("code",[t._v("service labels")]),t._v(" are defined, "),s("code",[t._v("container labels")]),t._v(" are just used as default values for missing "),s("code",[t._v("service labels")]),t._v(" but no frontend/backend are going to be defined only with these labels.\nObviously, labels "),s("code",[t._v("traefik.frontend.rule")]),t._v(" and "),s("code",[t._v("traefik.port")]),t._v(" described above, will only be used to complete information set in "),s("code",[t._v("service labels")]),t._v(" during the container frontends/backends creation.")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("In the example, two service names are defined : "),e("code",[this._v("basic")]),this._v(" and "),e("code",[this._v("admin")]),this._v(".\nThey allow creating two frontends and two backends.")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("ul",[s("li",[s("code",[t._v("basic")]),t._v(" has only one "),s("code",[t._v("service label")]),t._v(" : "),s("code",[t._v("traefik.basic.protocol")]),t._v(".\nTraefik will use values set in "),s("code",[t._v("traefik.frontend.rule")]),t._v(" and "),s("code",[t._v("traefik.port")]),t._v(" to create the "),s("code",[t._v("basic")]),t._v(" frontend and backend.\nThe frontend listens to incoming HTTP requests which contain the "),s("code",[t._v("Host")]),t._v(" "),s("code",[t._v("app.my-awesome-app.org")]),t._v(" and redirect them in "),s("code",[t._v("HTTP")]),t._v(" to the port "),s("code",[t._v("9000")]),t._v(" of the backend.")]),t._v(" "),s("li",[s("code",[t._v("admin")]),t._v(" has all the "),s("code",[t._v("services labels")]),t._v(" needed to create the "),s("code",[t._v("admin")]),t._v(" frontend and backend ("),s("code",[t._v("traefik.admin.frontend.rule")]),t._v(", "),s("code",[t._v("traefik.admin.protocol")]),t._v(", "),s("code",[t._v("traefik.admin.port")]),t._v(").\nTraefik will create a frontend to listen to incoming HTTP requests which contain the "),s("code",[t._v("Host")]),t._v(" "),s("code",[t._v("admin-app.my-awesome-app.org")]),t._v(" and redirect them in "),s("code",[t._v("HTTPS")]),t._v(" to the port "),s("code",[t._v("9443")]),t._v(" of the backend.")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h4",{attrs:{id:"gotchas-and-tips"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#gotchas-and-tips","aria-hidden":"true"}},[this._v("#")]),this._v(" Gotchas and tips")])},function(){var t=this.$createElement,e=this._self._c||t;return e("li",[this._v("Always specify the correct port where the container expects HTTP traffic using "),e("code",[this._v("traefik.port")]),this._v(" label."),e("br"),this._v("\nIf a container exposes multiple ports, Traefik may forward traffic to the wrong port.\nEven if a container only exposes one port, you should always write configuration defensively and explicitly.")])},function(){var t=this.$createElement,e=this._self._c||t;return e("li",[this._v("Should you choose to enable the "),e("code",[this._v("exposedByDefault")]),this._v(" flag in the "),e("code",[this._v("traefik.toml")]),this._v(" configuration, be aware that all containers that are placed in the same network as Traefik will automatically be reachable from the outside world, for everyone and everyone to see.\nUsually, this is a bad idea.")])},function(){var t=this.$createElement,e=this._self._c||t;return e("li",[this._v("With the "),e("code",[this._v("traefik.frontend.auth.basic")]),this._v(" label, it's possible for Traefik to provide a HTTP basic-auth challenge for the endpoints you provide the label for.")])},function(){var t=this.$createElement,e=this._self._c||t;return e("li",[this._v("Traefik supports websockets out of the box. In the example above, the "),e("code",[this._v("events")]),this._v("-service could be a NodeJS-based application which allows clients to connect using websocket protocol.\nThanks to the fact that HTTPS in our example is enforced, these websockets are automatically secure as well (WSS)")])},function(){var t=this.$createElement,e=this._self._c||t;return e("h3",{attrs:{id:"final-thoughts"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#final-thoughts","aria-hidden":"true"}},[this._v("#")]),this._v(" Final thoughts")])}],!1,null,null,null);e.default=n.exports}}]);