<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Key-value store configuration | Traefik</title>
    <meta name="description" content="Traefik Documentation">
    
    
    <link rel="preload" href="/traefik/assets/css/0.styles.ff21fc36.css" as="style"><link rel="preload" href="/traefik/assets/js/app.ae787784.js" as="script"><link rel="preload" href="/traefik/assets/js/36.308bc37c.js" as="script"><link rel="prefetch" href="/traefik/assets/js/10.d9f32ac0.js"><link rel="prefetch" href="/traefik/assets/js/11.375b726e.js"><link rel="prefetch" href="/traefik/assets/js/12.9acb0324.js"><link rel="prefetch" href="/traefik/assets/js/13.8f411b20.js"><link rel="prefetch" href="/traefik/assets/js/14.5aa54c49.js"><link rel="prefetch" href="/traefik/assets/js/15.18320535.js"><link rel="prefetch" href="/traefik/assets/js/16.f386789a.js"><link rel="prefetch" href="/traefik/assets/js/17.7c01ac03.js"><link rel="prefetch" href="/traefik/assets/js/18.3c97b5d1.js"><link rel="prefetch" href="/traefik/assets/js/19.1483f0a7.js"><link rel="prefetch" href="/traefik/assets/js/2.f0fe713b.js"><link rel="prefetch" href="/traefik/assets/js/20.0485452d.js"><link rel="prefetch" href="/traefik/assets/js/21.f2312fc4.js"><link rel="prefetch" href="/traefik/assets/js/22.ee03f9ff.js"><link rel="prefetch" href="/traefik/assets/js/23.647e2047.js"><link rel="prefetch" href="/traefik/assets/js/24.e91ab9c9.js"><link rel="prefetch" href="/traefik/assets/js/25.6d2905c1.js"><link rel="prefetch" href="/traefik/assets/js/26.6b0b7881.js"><link rel="prefetch" href="/traefik/assets/js/27.a1e67edd.js"><link rel="prefetch" href="/traefik/assets/js/28.858e5d66.js"><link rel="prefetch" href="/traefik/assets/js/29.26643758.js"><link rel="prefetch" href="/traefik/assets/js/3.c340e227.js"><link rel="prefetch" href="/traefik/assets/js/30.e4524922.js"><link rel="prefetch" href="/traefik/assets/js/31.cb24e220.js"><link rel="prefetch" href="/traefik/assets/js/32.d475b1ed.js"><link rel="prefetch" href="/traefik/assets/js/33.f84e04da.js"><link rel="prefetch" href="/traefik/assets/js/34.bbe37568.js"><link rel="prefetch" href="/traefik/assets/js/35.2c01db0b.js"><link rel="prefetch" href="/traefik/assets/js/37.5d1dbe7b.js"><link rel="prefetch" href="/traefik/assets/js/38.9377ad2b.js"><link rel="prefetch" href="/traefik/assets/js/39.e1a55eef.js"><link rel="prefetch" href="/traefik/assets/js/4.90ba113d.js"><link rel="prefetch" href="/traefik/assets/js/40.eea6044f.js"><link rel="prefetch" href="/traefik/assets/js/5.fae081a3.js"><link rel="prefetch" href="/traefik/assets/js/6.a2ec5521.js"><link rel="prefetch" href="/traefik/assets/js/7.3779a4fa.js"><link rel="prefetch" href="/traefik/assets/js/8.58f6dd40.js"><link rel="prefetch" href="/traefik/assets/js/9.96dc80cc.js">
    <link rel="stylesheet" href="/traefik/assets/css/0.styles.ff21fc36.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/traefik/" class="home-link router-link-active"><!----> <span class="site-name">Traefik</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><!---->  <ul class="sidebar-links"><li><a href="/traefik/" class="sidebar-link">Getting Started</a></li><li><a href="/traefik/basics.html" class="sidebar-link">Basics</a></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Configuration</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading open"><span>User Guides</span> <span class="arrow down"></span></p> <ul class="sidebar-group-items"><li><a href="/traefik/user-guide/examples.html" class="sidebar-link">Configuration Examples</a></li><li><a href="/traefik/user-guide/swarm-mode.html" class="sidebar-link">Swarm Mode Cluster</a></li><li><a href="/traefik/user-guide/swarm.html" class="sidebar-link">Swarm Cluster</a></li><li><a href="/traefik/user-guide/docker-and-lets-encrypt.html" class="sidebar-link">Let's Encrypt &amp; Docker</a></li><li><a href="/traefik/user-guide/kubernetes.html" class="sidebar-link">Kubernetes</a></li><li><a href="/traefik/user-guide/marathon.html" class="sidebar-link">Marathon</a></li><li><a href="/traefik/user-guide/kv-config.html" class="active sidebar-link">Key-value Store Configuration</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/traefik/user-guide/kv-config.html#static-configuration-in-key-value-store" class="sidebar-link">Static configuration in Key-value store</a></li><li class="sidebar-sub-header"><a href="/traefik/user-guide/kv-config.html#dynamic-configuration-in-key-value-store" class="sidebar-link">Dynamic configuration in Key-value store</a></li><li class="sidebar-sub-header"><a href="/traefik/user-guide/kv-config.html#store-configuration-in-key-value-store" class="sidebar-link">Store configuration in Key-value store</a></li></ul></li><li><a href="/traefik/user-guide/cluster.html" class="sidebar-link">Clustering/HA</a></li><li><a href="/traefik/user-guide/grpc.html" class="sidebar-link">gRPC Example</a></li><li><a href="/traefik/user-guide/cluster-docker-consul.html" class="sidebar-link">Traefik cluster example with Swarm</a></li></ul></div></li></ul> </div> <div class="page"> <div class="content"><h1 id="key-value-store-configuration"><a href="#key-value-store-configuration" aria-hidden="true" class="header-anchor">#</a> Key-value store configuration</h1> <p>Both <a href="/traefik/user-guide/kv-config/#static-configuration-in-key-value-store">static global configuration</a> and <a href="/traefik/user-guide/kv-config/#dynamic-configuration-in-key-value-store">dynamic</a> configuration can be stored in a Key-value store.</p> <p>This section explains how to launch Traefik using a configuration loaded from a Key-value store.</p> <p>Traefik supports several Key-value stores:</p> <ul><li><a href="https://consul.io" target="_blank" rel="noopener noreferrer">Consul<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://coreos.com/etcd/" target="_blank" rel="noopener noreferrer">etcd<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://zookeeper.apache.org/" target="_blank" rel="noopener noreferrer">ZooKeeper<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://github.com/boltdb/bolt" target="_blank" rel="noopener noreferrer">boltdb<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <h2 id="static-configuration-in-key-value-store"><a href="#static-configuration-in-key-value-store" aria-hidden="true" class="header-anchor">#</a> Static configuration in Key-value store</h2> <p>We will see the steps to set it up with an easy example.</p> <div class="tip custom-block"><p class="custom-block-title">TIP</p> <pre><code>We could do the same with any other Key-value Store.
</code></pre></div> <h3 id="docker-compose-file-for-consul"><a href="#docker-compose-file-for-consul" aria-hidden="true" class="header-anchor">#</a> docker-compose file for Consul</h3> <p>The Traefik global configuration will be retrieved from a <a href="https://consul.io" target="_blank" rel="noopener noreferrer">Consul<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> store.</p> <p>First we have to launch Consul in a container.</p> <p>The <a href="https://docs.docker.com/compose/compose-file/" target="_blank" rel="noopener noreferrer">docker-compose file<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> allows us to launch Consul and four instances of the trivial app <a href="https://github.com/containous/whoami" target="_blank" rel="noopener noreferrer">containous/whoami<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> :</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">consul</span><span class="token punctuation">:</span>
  <span class="token key atrule">image</span><span class="token punctuation">:</span> progrium/consul
  <span class="token key atrule">command</span><span class="token punctuation">:</span> <span class="token punctuation">-</span>server <span class="token punctuation">-</span>bootstrap <span class="token punctuation">-</span>log<span class="token punctuation">-</span>level debug <span class="token punctuation">-</span>ui<span class="token punctuation">-</span>dir /ui
  <span class="token key atrule">ports</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token string">&quot;8400:8400&quot;</span>
    <span class="token punctuation">-</span> <span class="token string">&quot;8500:8500&quot;</span>
    <span class="token punctuation">-</span> <span class="token string">&quot;8600:53/udp&quot;</span>
  <span class="token key atrule">expose</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token string">&quot;8300&quot;</span>
    <span class="token punctuation">-</span> <span class="token string">&quot;8301&quot;</span>
    <span class="token punctuation">-</span> <span class="token string">&quot;8301/udp&quot;</span>
    <span class="token punctuation">-</span> <span class="token string">&quot;8302&quot;</span>
    <span class="token punctuation">-</span> <span class="token string">&quot;8302/udp&quot;</span>

<span class="token key atrule">whoami1</span><span class="token punctuation">:</span>
  <span class="token key atrule">image</span><span class="token punctuation">:</span> containous/whoami

<span class="token key atrule">whoami2</span><span class="token punctuation">:</span>
  <span class="token key atrule">image</span><span class="token punctuation">:</span> containous/whoami

<span class="token key atrule">whoami3</span><span class="token punctuation">:</span>
  <span class="token key atrule">image</span><span class="token punctuation">:</span> containous/whoami

<span class="token key atrule">whoami4</span><span class="token punctuation">:</span>
  <span class="token key atrule">image</span><span class="token punctuation">:</span> containous/whoami
</code></pre></div><h3 id="upload-the-configuration-in-the-key-value-store"><a href="#upload-the-configuration-in-the-key-value-store" aria-hidden="true" class="header-anchor">#</a> Upload the configuration in the Key-value store</h3> <p>We should now fill the store with the Traefik global configuration.<br>
To do that, we can send the Key-value pairs via <a href="https://www.consul.io/intro/getting-started/kv.html" target="_blank" rel="noopener noreferrer">curl commands<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> or via the <a href="https://www.consul.io/intro/getting-started/ui.html" target="_blank" rel="noopener noreferrer">Web UI<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</p> <p>Fortunately, Traefik allows automation of this process using the <code>storeconfig</code> subcommand.<br>
Please refer to the <a href="/traefik/user-guide/kv-config/#store-configuration-in-key-value-store">store Traefik configuration</a> section to get documentation on it.</p> <p>Here is the toml configuration we would like to store in the Key-value Store  :</p> <div class="language-ini extra-class"><pre class="language-ini"><code><span class="token constant">logLevel</span> <span class="token attr-value"><span class="token punctuation">=</span> &quot;DEBUG&quot;</span>

<span class="token constant">defaultEntryPoints</span> <span class="token attr-value"><span class="token punctuation">=</span> [&quot;http&quot;, &quot;https&quot;]</span>

<span class="token selector">[entryPoints]</span>
<span class="token selector">  [entryPoints.api]</span>
<span class="token constant">    address</span> <span class="token attr-value"><span class="token punctuation">=</span> &quot;:8081&quot;</span>
<span class="token selector">  [entryPoints.http]</span>
<span class="token constant">  address</span> <span class="token attr-value"><span class="token punctuation">=</span> &quot;:80&quot;</span>
<span class="token selector">  [entryPoints.https]</span>
<span class="token constant">  address</span> <span class="token attr-value"><span class="token punctuation">=</span> &quot;:443&quot;</span>

<span class="token selector">    [entryPoints.https.tls]</span>
<span class="token selector">      [[entryPoints.https.tls.certificates]</span>]
<span class="token constant">      certFile</span> <span class="token attr-value"><span class="token punctuation">=</span> &quot;integration/fixtures/https/snitest.com.cert&quot;</span>
<span class="token constant">      keyFile</span> <span class="token attr-value"><span class="token punctuation">=</span> &quot;integration/fixtures/https/snitest.com.key&quot;</span>
<span class="token selector">      [[entryPoints.https.tls.certificates]</span>]
<span class="token constant">      certFile</span> <span class="token attr-value"><span class="token punctuation">=</span> &quot;&quot;&quot;-----BEGIN CERTIFICATE-----</span>
                      &lt;cert file content&gt;
                      -----END CERTIFICATE-----&quot;&quot;&quot;
<span class="token constant">      keyFile</span> <span class="token attr-value"><span class="token punctuation">=</span> &quot;&quot;&quot;-----BEGIN PRIVATE KEY-----</span>
                      &lt;key file content&gt;
                      -----END PRIVATE KEY-----&quot;&quot;&quot;
<span class="token selector">    [entryPoints.other-https]</span>
<span class="token constant">    address</span> <span class="token attr-value"><span class="token punctuation">=</span> &quot;:4443&quot;</span>
<span class="token selector">      [entryPoints.other-https.tls]</span>

<span class="token selector">[consul]</span>
<span class="token constant">  endpoint</span> <span class="token attr-value"><span class="token punctuation">=</span> &quot;127.0.0.1:8500&quot;</span>
<span class="token constant">  watch</span> <span class="token attr-value"><span class="token punctuation">=</span> true</span>
<span class="token constant">  prefix</span> <span class="token attr-value"><span class="token punctuation">=</span> &quot;traefik&quot;</span>

<span class="token selector">[api]</span>
<span class="token constant">  entrypoint</span> <span class="token attr-value"><span class="token punctuation">=</span> &quot;api&quot;</span>
</code></pre></div><p>And there, the same global configuration in the Key-value Store (using <code>prefix = &quot;traefik&quot;</code>):</p> <table><thead><tr><th>Key</th> <th>Value</th></tr></thead> <tbody><tr><td><code>/traefik/loglevel</code></td> <td><code>DEBUG</code></td></tr> <tr><td><code>/traefik/defaultentrypoints/0</code></td> <td><code>http</code></td></tr> <tr><td><code>/traefik/defaultentrypoints/1</code></td> <td><code>https</code></td></tr> <tr><td><code>/traefik/entrypoints/api/address</code></td> <td><code>:8081</code></td></tr> <tr><td><code>/traefik/entrypoints/http/address</code></td> <td><code>:80</code></td></tr> <tr><td><code>/traefik/entrypoints/https/address</code></td> <td><code>:443</code></td></tr> <tr><td><code>/traefik/entrypoints/https/tls/certificates/0/certfile</code></td> <td><code>integration/fixtures/https/snitest.com.cert</code></td></tr> <tr><td><code>/traefik/entrypoints/https/tls/certificates/0/keyfile</code></td> <td><code>integration/fixtures/https/snitest.com.key</code></td></tr> <tr><td><code>/traefik/entrypoints/https/tls/certificates/1/certfile</code></td> <td><code>--BEGIN CERTIFICATE--&lt;cert file content&gt;--END CERTIFICATE--</code></td></tr> <tr><td><code>/traefik/entrypoints/https/tls/certificates/1/keyfile</code></td> <td><code>--BEGIN CERTIFICATE--&lt;key file content&gt;--END CERTIFICATE--</code></td></tr> <tr><td><code>/traefik/entrypoints/other-https/address</code></td> <td><code>:4443</code></td></tr> <tr><td><code>/traefik/consul/endpoint</code></td> <td><code>127.0.0.1:8500</code></td></tr> <tr><td><code>/traefik/consul/watch</code></td> <td><code>true</code></td></tr> <tr><td><code>/traefik/consul/prefix</code></td> <td><code>traefik</code></td></tr> <tr><td><code>/traefik/api/entrypoint</code></td> <td><code>api</code></td></tr></tbody></table> <p>In case you are setting key values manually:</p> <ul><li>Remember to specify the indexes (<code>0</code>,<code>1</code>, <code>2</code>, ... ) under prefixes <code>/traefik/defaultentrypoints/</code> and <code>/traefik/entrypoints/https/tls/certificates/</code> in order to match the global configuration structure.</li> <li>Be careful to give the correct IP address and port on the key <code>/traefik/consul/endpoint</code>.</li></ul> <p>Note that we can either give path to certificate file or directly the file content itself.</p> <h3 id="launch-traefik"><a href="#launch-traefik" aria-hidden="true" class="header-anchor">#</a> Launch Traefik</h3> <p>We will now launch Traefik in a container.</p> <p>We use CLI flags to setup the connection between Traefik and Consul.
All the rest of the global configuration is stored in Consul.</p> <p>Here is the <a href="https://docs.docker.com/compose/compose-file/" target="_blank" rel="noopener noreferrer">docker-compose file<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> :</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">traefik</span><span class="token punctuation">:</span>
  <span class="token key atrule">image</span><span class="token punctuation">:</span> traefik
  <span class="token key atrule">command</span><span class="token punctuation">:</span> <span class="token punctuation">-</span><span class="token punctuation">-</span>consul <span class="token punctuation">-</span><span class="token punctuation">-</span>consul.endpoint=127.0.0.1<span class="token punctuation">:</span><span class="token number">8500</span>
  <span class="token key atrule">ports</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token string">&quot;80:80&quot;</span>
    <span class="token punctuation">-</span> <span class="token string">&quot;8080:8080&quot;</span>
</code></pre></div><p>!!! warning
Be careful to give the correct IP address and port in the flag <code>--consul.endpoint</code>.</p> <h3 id="consul-acl-token-support"><a href="#consul-acl-token-support" aria-hidden="true" class="header-anchor">#</a> Consul ACL Token support</h3> <p>To specify a Consul ACL token for Traefik, we have to set a System Environment variable named <code>CONSUL_HTTP_TOKEN</code> prior to starting Traefik.
This variable must be initialized with the ACL token value.</p> <p>If Traefik is launched into a Docker container, the variable <code>CONSUL_HTTP_TOKEN</code> can be initialized with the <code>-e</code> Docker option : <code>-e &quot;CONSUL_HTTP_TOKEN=[consul-acl-token-value]&quot;</code></p> <p>If a Consul ACL is used to restrict Traefik read/write access, one of the following configurations is needed.</p> <ul><li>HCL format :</li></ul> <div class="language- extra-class"><pre class="language-text"><code>    key &quot;traefik&quot; {
        policy = &quot;write&quot;
    },

    session &quot;&quot; {
        policy = &quot;write&quot;
    }
</code></pre></div><ul><li>JSON format :</li></ul> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;key&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;traefik&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">&quot;policy&quot;</span><span class="token operator">:</span> <span class="token string">&quot;write&quot;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;session&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;policy&quot;</span><span class="token operator">:</span> <span class="token string">&quot;write&quot;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="tls-support"><a href="#tls-support" aria-hidden="true" class="header-anchor">#</a> TLS support</h3> <p>To connect to a Consul endpoint using SSL, simply specify <code>https://</code> in the <code>consul.endpoint</code> property</p> <ul><li><code>--consul.endpoint=https://[consul-host]:[consul-ssl-port]</code></li></ul> <h3 id="tls-support-with-client-certificates"><a href="#tls-support-with-client-certificates" aria-hidden="true" class="header-anchor">#</a> TLS support with client certificates</h3> <p>So far, only <a href="https://consul.io" target="_blank" rel="noopener noreferrer">Consul<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> and <a href="https://coreos.com/etcd/" target="_blank" rel="noopener noreferrer">etcd<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> support TLS connections with client certificates.</p> <p>To set it up, we should enable <a href="https://www.consul.io/docs/internals/security.html" target="_blank" rel="noopener noreferrer">consul security<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> (or <a href="https://coreos.com/etcd/docs/latest/security.html" target="_blank" rel="noopener noreferrer">etcd security<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>).</p> <p>Then, we have to provide CA, Cert and Key to Traefik using <code>consul</code> flags :</p> <ul><li><code>--consul.tls</code></li> <li><code>--consul.tls.ca=path/to/the/file</code></li> <li><code>--consul.tls.cert=path/to/the/file</code></li> <li><code>--consul.tls.key=path/to/the/file</code></li></ul> <p>Or etcd flags :</p> <ul><li><code>--etcd.tls</code></li> <li><code>--etcd.tls.ca=path/to/the/file</code></li> <li><code>--etcd.tls.cert=path/to/the/file</code></li> <li><code>--etcd.tls.key=path/to/the/file</code></li></ul> <p>!! note
We can either give directly directly the file content itself (instead of the path to certificate) in a TOML file configuration.</p> <p>Remember the command <code>traefik --help</code> to display the updated list of flags.</p> <h2 id="dynamic-configuration-in-key-value-store"><a href="#dynamic-configuration-in-key-value-store" aria-hidden="true" class="header-anchor">#</a> Dynamic configuration in Key-value store</h2> <p>Following our example, we will provide backends/frontends  rules and HTTPS certificates to Traefik.</p> <div class="tip custom-block"><p class="custom-block-title">TIP</p> <pre><code>This section is independent of the way Traefik got its static configuration.
It means that the static configuration can either come from the same Key-value store or from any other sources.
</code></pre></div> <h3 id="key-value-storage-structure"><a href="#key-value-storage-structure" aria-hidden="true" class="header-anchor">#</a> Key-value storage structure</h3> <p>Here is the toml configuration we would like to store in the store :</p> <div class="language-ini extra-class"><pre class="language-ini"><code><span class="token selector">[file]</span>

# rules
<span class="token selector">[backends]</span>
<span class="token selector">  [backends.backend1]</span>
<span class="token selector">    [backends.backend1.circuitbreaker]</span>
<span class="token constant">    expression</span> <span class="token attr-value"><span class="token punctuation">=</span> &quot;NetworkErrorRatio() &gt; 0.5&quot;</span>
<span class="token selector">    [backends.backend1.servers.server1]</span>
<span class="token constant">    url</span> <span class="token attr-value"><span class="token punctuation">=</span> &quot;http://172.17.0.2:80&quot;</span>
<span class="token constant">    weight</span> <span class="token attr-value"><span class="token punctuation">=</span> 10</span>
<span class="token selector">    [backends.backend1.servers.server2]</span>
<span class="token constant">    url</span> <span class="token attr-value"><span class="token punctuation">=</span> &quot;http://172.17.0.3:80&quot;</span>
<span class="token constant">    weight</span> <span class="token attr-value"><span class="token punctuation">=</span> 1</span>
<span class="token selector">  [backends.backend2]</span>
<span class="token selector">    [backends.backend1.maxconn]</span>
<span class="token constant">    amount</span> <span class="token attr-value"><span class="token punctuation">=</span> 10</span>
<span class="token constant">    extractorfunc</span> <span class="token attr-value"><span class="token punctuation">=</span> &quot;request.host&quot;</span>
<span class="token selector">    [backends.backend2.LoadBalancer]</span>
<span class="token constant">    method</span> <span class="token attr-value"><span class="token punctuation">=</span> &quot;drr&quot;</span>
<span class="token selector">    [backends.backend2.servers.server1]</span>
<span class="token constant">    url</span> <span class="token attr-value"><span class="token punctuation">=</span> &quot;http://172.17.0.4:80&quot;</span>
<span class="token constant">    weight</span> <span class="token attr-value"><span class="token punctuation">=</span> 1</span>
<span class="token selector">    [backends.backend2.servers.server2]</span>
<span class="token constant">    url</span> <span class="token attr-value"><span class="token punctuation">=</span> &quot;http://172.17.0.5:80&quot;</span>
<span class="token constant">    weight</span> <span class="token attr-value"><span class="token punctuation">=</span> 2</span>

<span class="token selector">[frontends]</span>
<span class="token selector">  [frontends.frontend1]</span>
<span class="token constant">  backend</span> <span class="token attr-value"><span class="token punctuation">=</span> &quot;backend2&quot;</span>
<span class="token selector">    [frontends.frontend1.routes.test_1]</span>
<span class="token constant">    rule</span> <span class="token attr-value"><span class="token punctuation">=</span> &quot;Host:test.localhost&quot;</span>
<span class="token selector">  [frontends.frontend2]</span>
<span class="token constant">  backend</span> <span class="token attr-value"><span class="token punctuation">=</span> &quot;backend1&quot;</span>
<span class="token constant">  passHostHeader</span> <span class="token attr-value"><span class="token punctuation">=</span> true</span>
<span class="token constant">  priority</span> <span class="token attr-value"><span class="token punctuation">=</span> 10</span>
<span class="token selector">      [frontends.frontend2.auth.basic]</span>
<span class="token constant">      users</span> <span class="token attr-value"><span class="token punctuation">=</span> [</span>
        &quot;test:$apr1$H6uskkkW$IgXLP6ewTrSuBkTrqE8wj/&quot;,
        &quot;test2:$apr1$d9hr9HBB$4HxwgUir3HP4EsggP/QNo0&quot;,
      ]
<span class="token constant">  entrypoints</span> <span class="token attr-value"><span class="token punctuation">=</span> [&quot;https&quot;] # overrides defaultEntryPoints</span>
<span class="token selector">    [frontends.frontend2.routes.test_1]</span>
<span class="token constant">    rule</span> <span class="token attr-value"><span class="token punctuation">=</span> &quot;Host:{subdomain:[a-z]+}.localhost&quot;</span>
<span class="token selector">  [frontends.frontend3]</span>
<span class="token constant">  entrypoints</span> <span class="token attr-value"><span class="token punctuation">=</span> [&quot;http&quot;, &quot;https&quot;] # overrides defaultEntryPoints</span>
<span class="token constant">  backend</span> <span class="token attr-value"><span class="token punctuation">=</span> &quot;backend2&quot;</span>
<span class="token constant">  rule</span> <span class="token attr-value"><span class="token punctuation">=</span> &quot;Path:/test&quot;</span>

<span class="token selector">[[tls]</span>]
<span class="token selector">  [tls.certificate]</span>
<span class="token constant">    certFile</span> <span class="token attr-value"><span class="token punctuation">=</span> &quot;path/to/your.cert&quot;</span>
<span class="token constant">    keyFile</span> <span class="token attr-value"><span class="token punctuation">=</span> &quot;path/to/your.key&quot;</span>

<span class="token selector">[[tls]</span>]
<span class="token constant">  entryPoints</span> <span class="token attr-value"><span class="token punctuation">=</span> [&quot;https&quot;,&quot;other-https&quot;]</span>
<span class="token selector">  [tls.certificate]</span>
<span class="token constant">    certFile</span> <span class="token attr-value"><span class="token punctuation">=</span> &quot;&quot;&quot;-----BEGIN CERTIFICATE-----</span>
                      &lt;cert file content&gt;
                      -----END CERTIFICATE-----&quot;&quot;&quot;
<span class="token constant">    keyFile</span> <span class="token attr-value"><span class="token punctuation">=</span> &quot;&quot;&quot;-----BEGIN CERTIFICATE-----</span>
                      &lt;key file content&gt;
                      -----END CERTIFICATE-----&quot;&quot;&quot;
</code></pre></div><p>And there, the same dynamic configuration in a KV Store (using <code>prefix = &quot;traefik&quot;</code>):</p> <ul><li>backend 1</li></ul> <table><thead><tr><th>Key</th> <th>Value</th></tr></thead> <tbody><tr><td><code>/traefik/backends/backend1/circuitbreaker/expression</code></td> <td><code>NetworkErrorRatio() &gt; 0.5</code></td></tr> <tr><td><code>/traefik/backends/backend1/servers/server1/url</code></td> <td><code>http://172.17.0.2:80</code></td></tr> <tr><td><code>/traefik/backends/backend1/servers/server1/weight</code></td> <td><code>10</code></td></tr> <tr><td><code>/traefik/backends/backend1/servers/server2/url</code></td> <td><code>http://172.17.0.3:80</code></td></tr> <tr><td><code>/traefik/backends/backend1/servers/server2/weight</code></td> <td><code>1</code></td></tr> <tr><td><code>/traefik/backends/backend1/servers/server2/tags</code></td> <td><code>api,helloworld</code></td></tr></tbody></table> <ul><li>backend 2</li></ul> <table><thead><tr><th>Key</th> <th>Value</th></tr></thead> <tbody><tr><td><code>/traefik/backends/backend2/maxconn/amount</code></td> <td><code>10</code></td></tr> <tr><td><code>/traefik/backends/backend2/maxconn/extractorfunc</code></td> <td><code>request.host</code></td></tr> <tr><td><code>/traefik/backends/backend2/loadbalancer/method</code></td> <td><code>drr</code></td></tr> <tr><td><code>/traefik/backends/backend2/servers/server1/url</code></td> <td><code>http://172.17.0.4:80</code></td></tr> <tr><td><code>/traefik/backends/backend2/servers/server1/weight</code></td> <td><code>1</code></td></tr> <tr><td><code>/traefik/backends/backend2/servers/server2/url</code></td> <td><code>http://172.17.0.5:80</code></td></tr> <tr><td><code>/traefik/backends/backend2/servers/server2/weight</code></td> <td><code>2</code></td></tr> <tr><td><code>/traefik/backends/backend2/servers/server2/tags</code></td> <td><code>web</code></td></tr></tbody></table> <ul><li>frontend 1</li></ul> <table><thead><tr><th>Key</th> <th>Value</th></tr></thead> <tbody><tr><td><code>/traefik/frontends/frontend1/backend</code></td> <td><code>backend2</code></td></tr> <tr><td><code>/traefik/frontends/frontend1/routes/test_1/rule</code></td> <td><code>Host:test.localhost</code></td></tr></tbody></table> <ul><li>frontend 2</li></ul> <table><thead><tr><th>Key</th> <th>Value</th></tr></thead> <tbody><tr><td><code>/traefik/frontends/frontend2/backend</code></td> <td><code>backend1</code></td></tr> <tr><td><code>/traefik/frontends/frontend2/passhostheader</code></td> <td><code>true</code></td></tr> <tr><td><code>/traefik/frontends/frontend2/priority</code></td> <td><code>10</code></td></tr> <tr><td><code>/traefik/frontends/frontend2/auth/basic/users/0</code></td> <td><code>test:$apr1$H6uskkkW$IgXLP6ewTrSuBkTrqE8wj/</code></td></tr> <tr><td><code>/traefik/frontends/frontend2/auth/basic/users/1</code></td> <td><code>test2:$apr1$d9hr9HBB$4HxwgUir3HP4EsggP/QNo0</code></td></tr> <tr><td><code>/traefik/frontends/frontend2/entrypoints</code></td> <td><code>http,https</code></td></tr> <tr><td><code>/traefik/frontends/frontend2/routes/test_2/rule</code></td> <td><code>PathPrefix:/test</code></td></tr></tbody></table> <ul><li>certificate 1</li></ul> <table><thead><tr><th>Key</th> <th>Value</th></tr></thead> <tbody><tr><td><code>/traefik/tls/1/certificate/certfile</code></td> <td><code>path/to/your.cert</code></td></tr> <tr><td><code>/traefik/tls/1/certificate/keyfile</code></td> <td><code>path/to/your.key</code></td></tr></tbody></table> <div class="tip custom-block"><p class="custom-block-title">TIP</p> <pre><code>As `/traefik/tls/1/entrypoints` is not defined, the certificate will be attached to all `defaulEntryPoints` with a TLS configuration (in the example, the entryPoint `https`)
</code></pre></div> <ul><li>certificate 2</li></ul> <table><thead><tr><th>Key</th> <th>Value</th></tr></thead> <tbody><tr><td><code>/traefik/tls/2/entrypoints</code></td> <td><code>https,other-https</code></td></tr> <tr><td><code>/traefik/tls/2/certificate/certfile</code></td> <td><code>&lt;cert file content&gt;</code></td></tr> <tr><td><code>/traefik/tls/2/certificate/keyfile</code></td> <td><code>&lt;key file content&gt;</code></td></tr></tbody></table> <h3 id="atomic-configuration-changes"><a href="#atomic-configuration-changes" aria-hidden="true" class="header-anchor">#</a> Atomic configuration changes</h3> <p>Traefik can watch the backends/frontends configuration changes and generate its configuration automatically.</p> <div class="tip custom-block"><p class="custom-block-title">TIP</p> <pre><code>Only backends/frontends rules are dynamic, the rest of the Traefik configuration stay static.
</code></pre></div> <p>The <a href="https://github.com/coreos/etcd/issues/860" target="_blank" rel="noopener noreferrer">Etcd<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> and <a href="https://github.com/hashicorp/consul/issues/886" target="_blank" rel="noopener noreferrer">Consul<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> backends do not support updating multiple keys atomically.<br>
As a result, it may be possible for Traefik to read an intermediate configuration state despite judicious use of the <code>--providersThrottleDuration</code> flag.<br>
To solve this problem, Traefik supports a special key called <code>/traefik/alias</code>.
If set, Traefik use the value as an alternative key prefix.</p> <p>Given the key structure below, Traefik will use the <code>http://172.17.0.2:80</code> as its only backend (frontend keys have been omitted for brevity).</p> <table><thead><tr><th>Key</th> <th>Value</th></tr></thead> <tbody><tr><td><code>/traefik/alias</code></td> <td><code>/traefik_configurations/1</code></td></tr> <tr><td><code>/traefik_configurations/1/backends/backend1/servers/server1/url</code></td> <td><code>http://172.17.0.2:80</code></td></tr> <tr><td><code>/traefik_configurations/1/backends/backend1/servers/server1/weight</code></td> <td><code>10</code></td></tr></tbody></table> <p>When an atomic configuration change is required, you may write a new configuration at an alternative prefix.</p> <p>Here, although the <code>/traefik_configurations/2/...</code> keys have been set, the old configuration is still active because the <code>/traefik/alias</code> key still points to <code>/traefik_configurations/1</code>:</p> <table><thead><tr><th>Key</th> <th>Value</th></tr></thead> <tbody><tr><td><code>/traefik/alias</code></td> <td><code>/traefik_configurations/1</code></td></tr> <tr><td><code>/traefik_configurations/1/backends/backend1/servers/server1/url</code></td> <td><code>http://172.17.0.2:80</code></td></tr> <tr><td><code>/traefik_configurations/1/backends/backend1/servers/server1/weight</code></td> <td><code>10</code></td></tr> <tr><td><code>/traefik_configurations/2/backends/backend1/servers/server1/url</code></td> <td><code>http://172.17.0.2:80</code></td></tr> <tr><td><code>/traefik_configurations/2/backends/backend1/servers/server1/weight</code></td> <td><code>5</code></td></tr> <tr><td><code>/traefik_configurations/2/backends/backend1/servers/server2/url</code></td> <td><code>http://172.17.0.3:80</code></td></tr> <tr><td><code>/traefik_configurations/2/backends/backend1/servers/server2/weight</code></td> <td><code>5</code></td></tr></tbody></table> <p>Once the <code>/traefik/alias</code> key is updated, the new <code>/traefik_configurations/2</code> configuration becomes active atomically.</p> <p>Here, we have a 50% balance between the <code>http://172.17.0.3:80</code> and the <code>http://172.17.0.4:80</code> hosts while no traffic is sent to the <code>172.17.0.2:80</code> host:</p> <table><thead><tr><th>Key</th> <th>Value</th></tr></thead> <tbody><tr><td><code>/traefik/alias</code></td> <td><code>/traefik_configurations/2</code></td></tr> <tr><td><code>/traefik_configurations/1/backends/backend1/servers/server1/url</code></td> <td><code>http://172.17.0.2:80</code></td></tr> <tr><td><code>/traefik_configurations/1/backends/backend1/servers/server1/weight</code></td> <td><code>10</code></td></tr> <tr><td><code>/traefik_configurations/2/backends/backend1/servers/server1/url</code></td> <td><code>http://172.17.0.3:80</code></td></tr> <tr><td><code>/traefik_configurations/2/backends/backend1/servers/server1/weight</code></td> <td><code>5</code></td></tr> <tr><td><code>/traefik_configurations/2/backends/backend1/servers/server2/url</code></td> <td><code>http://172.17.0.4:80</code></td></tr> <tr><td><code>/traefik_configurations/2/backends/backend1/servers/server2/weight</code></td> <td><code>5</code></td></tr></tbody></table> <div class="tip custom-block"><p class="custom-block-title">TIP</p> <pre><code>Traefik *will not watch for key changes in the `/traefik_configurations` prefix*. It will only watch for changes in the `/traefik/alias`.  
Further, if the `/traefik/alias` key is set, all other configuration with `/traefik/backends` or `/traefik/frontends` prefix are ignored.
</code></pre></div> <h2 id="store-configuration-in-key-value-store"><a href="#store-configuration-in-key-value-store" aria-hidden="true" class="header-anchor">#</a> Store configuration in Key-value store</h2> <div class="tip custom-block"><p class="custom-block-title">TIP</p> <pre><code>Don't forget to [setup the connection between Traefik and Key-value store](/user-guide/kv-config/#launch-traefik).
</code></pre></div> <p>The static Traefik configuration in a key-value store can be automatically created and updated, using the <a href="/traefik/basics/#commands"><code>storeconfig</code> subcommand</a>.</p> <div class="language-bash extra-class"><pre class="language-bash"><code>traefik storeconfig <span class="token punctuation">[</span>flags<span class="token punctuation">]</span> <span class="token punctuation">..</span>.
</code></pre></div><p>This command is here only to automate the <a href="/traefik/user-guide/kv-config/#upload-the-configuration-in-the-key-value-store">process which upload the configuration into the Key-value store</a>.
Traefik will not start but the <a href="/traefik/basics/#static-traefik-configuration">static configuration</a> will be uploaded into the Key-value store.</p> <p>If you configured ACME (Let's Encrypt), your registration account and your certificates will also be uploaded.</p> <p>If you configured a file provider <code>[file]</code>, all your dynamic configuration (backends, frontends...) will be uploaded to the Key-value store.</p> <p>To upload your ACME certificates to the KV store, get your Traefik TOML file and add the new <code>storage</code> option in the <code>acme</code> section:</p> <div class="language-ini extra-class"><pre class="language-ini"><code><span class="token selector">[acme]</span>
<span class="token constant">email</span> <span class="token attr-value"><span class="token punctuation">=</span> &quot;test@traefik.io&quot;</span>
<span class="token constant">storage</span> <span class="token attr-value"><span class="token punctuation">=</span> &quot;traefik/acme/account&quot; # the key where to store your certificates in the KV store</span>
<span class="token constant">storageFile</span> <span class="token attr-value"><span class="token punctuation">=</span> &quot;acme.json&quot; # your old certificates store</span>
</code></pre></div><p>Call <code>traefik storeconfig</code> to upload your config in the KV store.
Then remove the line <code>storageFile = &quot;acme.json&quot;</code> from your TOML config file.</p> <p>That's it!</p> <p><img src="https://i.giphy.com/ujUdrdpX7Ok5W.gif" alt="GIF Magica"></p></div> <div class="page-edit"><!----> <!----></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/traefik/user-guide/marathon.html" class="prev">
          Marathon
        </a></span> <span class="next"><a href="/traefik/user-guide/cluster.html">
          Clustering/HA
        </a>
        →
      </span></p></div> </div> <!----></div></div>
    <script src="/traefik/assets/js/app.ae787784.js" defer></script><script src="/traefik/assets/js/36.308bc37c.js" defer></script>
  </body>
</html>
